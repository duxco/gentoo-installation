
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Gentoo installation using Measured Boot, Secure Boot, Full Disk Encryption, RAID and offering a rescue system based on customised SystemRescueCD">
      
      
        <meta name="author" content="David Sardari">
      
      
        <link rel="canonical" href="https://gentoo.duxsco.de/selinux/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.0">
    
    
      
        <title>9. SELinux (WIP) - Gentoo Linux Installation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#91-enable-selinux" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Gentoo Linux Installation" class="md-header__button md-logo" aria-label="Gentoo Linux Installation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gentoo Linux Installation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              9. SELinux (WIP)
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/duxsco/gentoo-installation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
  </div>
  <div class="md-source__repository">
    duxsco/gentoo-installation
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Gentoo Linux Installation" class="md-nav__button md-logo" aria-label="Gentoo Linux Installation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Gentoo Linux Installation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/duxsco/gentoo-installation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
  </div>
  <div class="md-source__repository">
    duxsco/gentoo-installation
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        1. Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../live-cd_environment/" class="md-nav__link">
        2. Live-CD Environment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disk_setup/" class="md-nav__link">
        3. Disk Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../rescue_system/" class="md-nav__link">
        4. Rescue System
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../chrooting/" class="md-nav__link">
        5. Chrooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../system_setup/" class="md-nav__link">
        6. System Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cleanup_and_reboot/" class="md-nav__link">
        7. Cleanup And Reboot
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../post-boot_configuration/" class="md-nav__link">
        8. Post-Boot Configuration
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          9. SELinux (WIP)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        9. SELinux (WIP)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#91-enable-selinux" class="md-nav__link">
    9.1. Enable SELinux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#92-relabel" class="md-nav__link">
    9.2. Relabel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#93-selinux-policies" class="md-nav__link">
    9.3. SELinux policies
  </a>
  
    <nav class="md-nav" aria-label="9.3. SELinux policies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931-exclusion-of-dontaudit-denials" class="md-nav__link">
    9.3.1. Exclusion of dontaudit denials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932-inclusion-of-dontaudit-denials" class="md-nav__link">
    9.3.2. Inclusion of dontaudit denials
  </a>
  
    <nav class="md-nav" aria-label="9.3.2. Inclusion of dontaudit denials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meh" class="md-nav__link">
    meh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../other_gentoo_linux_repos/" class="md-nav__link">
        10. Other Gentoo Linux repos
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#91-enable-selinux" class="md-nav__link">
    9.1. Enable SELinux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#92-relabel" class="md-nav__link">
    9.2. Relabel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#93-selinux-policies" class="md-nav__link">
    9.3. SELinux policies
  </a>
  
    <nav class="md-nav" aria-label="9.3. SELinux policies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931-exclusion-of-dontaudit-denials" class="md-nav__link">
    9.3.1. Exclusion of dontaudit denials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932-inclusion-of-dontaudit-denials" class="md-nav__link">
    9.3.2. Inclusion of dontaudit denials
  </a>
  
    <nav class="md-nav" aria-label="9.3.2. Inclusion of dontaudit denials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meh" class="md-nav__link">
    meh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/duxsco/gentoo-installation/blob/main/docs/selinux.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>9. SELinux (WIP)</h1>

<h2 id="91-enable-selinux">9.1. Enable SELinux<a class="headerlink" href="#91-enable-selinux" title="Permanent link">&para;</a></h2>
<p>Currently, I only use SELinux on servers, and only <code>mcs</code> policy type to be able to "isolate" virtual machines from each other.</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="s1">&#39;POLICY_TYPES=&quot;mcs&quot;&#39;</span> &gt;&gt; /etc/portage/make.conf
eselect profile <span class="nb">set</span> --force <span class="m">18</span> <span class="c1"># should be &quot;[18]  default/linux/amd64/17.1/systemd/selinux (exp)&quot;</span>
<span class="nv">FEATURES</span><span class="o">=</span><span class="s2">&quot;-selinux&quot;</span> emerge -1 selinux-base
sed -i <span class="s1">&#39;s/^SELINUXTYPE=strict$/SELINUXTYPE=mcs/&#39;</span> /etc/selinux/config
<span class="nv">FEATURES</span><span class="o">=</span><span class="s2">&quot;-selinux -sesandbox&quot;</span> emerge -1 selinux-base
<span class="nv">FEATURES</span><span class="o">=</span><span class="s2">&quot;-selinux -sesandbox&quot;</span> emerge -1 selinux-base-policy
emerge -avuDN @world
</code></pre></div>
<p>Enable logging:</p>
<div class="highlight"><pre><span></span><code>systemctl <span class="nb">enable</span> auditd.service
</code></pre></div>
<p>Rebuild the kernel with SELinux support:</p>
<div class="highlight"><pre><span></span><code>emerge -at sys-kernel/gentoo-kernel-bin
</code></pre></div>
<h2 id="92-relabel">9.2. Relabel<a class="headerlink" href="#92-relabel" title="Permanent link">&para;</a></h2>
<p><a href="https://wiki.gentoo.org/wiki/SELinux/Installation#Relabel">Relabel the entire system</a>:</p>
<div class="highlight"><pre><span></span><code>mkdir /mnt/gentoo
mount -o <span class="nb">bind</span> / /mnt/gentoo
setfiles -r /mnt/gentoo /etc/selinux/mcs/contexts/files/file_contexts /mnt/gentoo/<span class="o">{</span>dev,home,proc,run,sys,tmp,efi*,var/cache/binpkgs,var/cache/distfiles,var/db/repos/gentoo,var/tmp<span class="o">}</span>
umount /mnt/gentoo
rlpkg -a -r
</code></pre></div>
<p>In the <a href="https://github.com/duxsco/gentoo-installation">custom Gentoo Linux installation</a>, the SSH port has been changed to 50022. This needs to be considered for no SELinux denials to occur:</p>
<div class="highlight"><pre><span></span><code>➤ semanage port -l <span class="p">|</span> grep -e ssh -e Port
SELinux Port Type              Proto    Port Number
ssh_port_t                     tcp      <span class="m">22</span>
➤ semanage port -a -t ssh_port_t -p tcp <span class="m">50022</span>
➤ semanage port -l <span class="p">|</span> grep -e ssh -e Port
SELinux Port Type              Proto    Port Number
ssh_port_t                     tcp      <span class="m">50022</span>, <span class="m">22</span>
</code></pre></div>
<h2 id="93-selinux-policies">9.3. SELinux policies<a class="headerlink" href="#93-selinux-policies" title="Permanent link">&para;</a></h2>
<p>The following log entries were retrieved over a serial connection while booting the test VM into enforcing mode.</p>
<h3 id="931-exclusion-of-dontaudit-denials">9.3.1. Exclusion of dontaudit denials<a class="headerlink" href="#931-exclusion-of-dontaudit-denials" title="Permanent link">&para;</a></h3>
<p>The following audit logs don't contain those <code>dontaudit</code> ones.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># [   40.783704] audit: type=1400 audit(1659801628.356:3): avc:  denied  { read } for  pid=3418 comm=&quot;10-gentoo-path&quot; name=&quot;profile.env&quot; dev=&quot;dm-2&quot; ino=2237658 scontext=system_u:system_r:systemd_generator_t:s0 tcontext=system_u:object_r:etc_runtime_t:s0 tclass=file permissive=0</span>

❯ find / -inum <span class="m">2237658</span>
/etc/profile.env

❯ semanage fcontext -l <span class="p">|</span> grep <span class="s1">&#39;/etc/profile\\\.env&#39;</span> <span class="p">|</span> column -t
/etc/profile<span class="se">\.</span>env  regular  file  system_u:object_r:etc_runtime_t:s0

❯ sesearch -A -s systemd_generator_t -c file -p <span class="nb">read</span> <span class="p">|</span> grep etc
allow systemd_generator_t etc_t:file <span class="o">{</span> getattr ioctl lock map open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>
allow systemd_generator_t lvm_etc_t:file <span class="o">{</span> getattr ioctl lock map open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ semanage fcontext -m -f f -t etc_t <span class="s1">&#39;/etc/profile\.env&#39;</span>

❯ restorecon -RFv /etc/profile.env
Relabeled /etc/profile.env from system_u:object_r:etc_runtime_t:s0 to system_u:object_r:etc_t:s0
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.215380] audit: type=1400 audit(1659803032.739:3): avc:  denied  { create } for  pid=1 comm=&quot;systemd&quot; name=&quot;io.systemd.NameServiceSwitch&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_userdbd_runtime_t:s0 tclass=lnk_file permissive=0</span>
<span class="s"># [   38.218433] systemd[1]: systemd-userdbd.socket: Failed to create symlink /run/systemd/userdb/io.systemd.Multiplexer → /run/systemd/userdb/io.systemd.NameServiceSwitch, ignoring: Permission denied</span>
<span class="s"># [   38.223036] systemd[1]: systemd-userdbd.socket: Failed to create symlink /run/systemd/userdb/io.systemd.Multiplexer → /run/systemd/userdb/io.systemd.DropIn, ignoring: Permission denied</span>
<span class="s">[   38.223037] audit: type=1400 audit(1659803032.749:4): avc:  denied  { create } for  pid=1 comm=&quot;systemd&quot; name=&quot;io.systemd.DropIn&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_userdbd_runtime_t:s0 tclass=lnk_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t systemd_userdbd_runtime_t:lnk_file create<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t systemd_userdbd_runtime_t:lnk_file create;&quot;</span> -c my_000000

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.348743] audit: type=1400 audit(1659804660.863:3): avc:  denied  { mounton } for  pid=3192 comm=&quot;(-userdbd)&quot; path=&quot;/run/systemd/unit-root/proc&quot; dev=&quot;dm-0&quot; ino=67034 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:unlabeled_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t unlabeled_t:dir mounton<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t unlabeled_t:dir mounton;&quot;</span> -c my_000001

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.650222] audit: type=1400 audit(1659806737.170:3): avc:  denied  { write } for  pid=3391 comm=&quot;systemd-udevd&quot; name=&quot;systemd-udevd.service&quot; dev=&quot;cgroup2&quot; ino=2051 scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:cgroup_t:s0 tclass=dir permissive=0</span>
<span class="s">[   39.204268] audit: type=1400 audit(1659808040.666:3): avc:  denied  { add_name } for  pid=3290 comm=&quot;systemd-udevd&quot; name=&quot;udev&quot; scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:cgroup_t:s0 tclass=dir permissive=0</span>
<span class="s">[   39.817148] audit: type=1400 audit(1659809598.336:3): avc:  denied  { create } for  pid=3405 comm=&quot;systemd-udevd&quot; name=&quot;udev&quot; scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:cgroup_t:s0 tclass=dir permissive=0</span>
<span class="s">[   41.510248] audit: type=1400 audit(1659810088.010:3): avc:  denied  { write } for  pid=3202 comm=&quot;systemd-udevd&quot; name=&quot;cgroup.procs&quot; dev=&quot;cgroup2&quot; ino=2086 scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:cgroup_t:s0 tclass=file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= udev_t ==============</span>

<span class="c1">#!!!! This avc is allowed in the current policy</span>
allow udev_t cgroup_t:dir <span class="o">{</span> add_name create write <span class="o">}</span><span class="p">;</span>
allow udev_t cgroup_t:file write<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow udev_t cgroup_t:dir { add_name create write };&quot;</span> -c my_000002_dir

❯ selocal -a <span class="s2">&quot;allow udev_t cgroup_t:file write;&quot;</span> -c my_000002_file

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   39.016492] audit: type=1400 audit(1659813497.523:3): avc:  denied  { read } for  pid=3405 comm=&quot;systemd-udevd&quot; name=&quot;network&quot; dev=&quot;tmpfs&quot; ino=78 scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= udev_t ==============</span>
allow udev_t init_runtime_t:dir read<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow udev_t init_runtime_t:dir read;&quot;</span> -c my_000003

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   39.725495] audit: type=1400 audit(1659818788.233:3): avc:  denied  { getattr } for  pid=3318 comm=&quot;mdadm&quot; path=&quot;/run/udev&quot; dev=&quot;tmpfs&quot; ino=71 scontext=system_u:system_r:mdadm_t:s0 tcontext=system_u:object_r:udev_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= mdadm_t ==============</span>
allow mdadm_t udev_runtime_t:dir getattr<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow mdadm_t udev_runtime_t:dir getattr;&quot;</span> -c my_000004

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   39.729566] audit: type=1400 audit(1659818788.233:4): avc:  denied  { search } for  pid=3318 comm=&quot;mdadm&quot; name=&quot;block&quot; dev=&quot;debugfs&quot; ino=29 scontext=system_u:system_r:mdadm_t:s0 tcontext=system_u:object_r:debugfs_t:s0 tclass=dir permissive=0</span>
<span class="s">[   39.732824] audit: type=1400 audit(1659818788.233:5): avc:  denied  { search } for  pid=3318 comm=&quot;mdadm&quot; name=&quot;bdi&quot; dev=&quot;debugfs&quot; ino=22 scontext=system_u:system_r:mdadm_t:s0 tcontext=system_u:object_r:debugfs_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= mdadm_t ==============</span>
allow mdadm_t debugfs_t:dir search<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow mdadm_t debugfs_t:dir search;&quot;</span> -c my_000005

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   39.069622] audit: type=1400 audit(1659889748.730:3): avc:  denied  { getattr } for  pid=26 comm=&quot;kdevtmpfs&quot; path=&quot;/fb0&quot; dev=&quot;devtmpfs&quot; ino=152 scontext=system_u:system_r:kernel_t:s0 tcontext=system_u:object_r:framebuf_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= kernel_t ==============</span>
allow kernel_t framebuf_device_t:chr_file getattr<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow kernel_t framebuf_device_t:chr_file getattr;&quot;</span> -c my_000006

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   39.408676] audit: type=1400 audit(1659890472.969:3): avc:  denied  { setattr } for  pid=26 comm=&quot;kdevtmpfs&quot; name=&quot;fb0&quot; dev=&quot;devtmpfs&quot; ino=152 scontext=system_u:system_r:kernel_t:s0 tcontext=system_u:object_r:framebuf_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">[   39.411761] audit: type=1400 audit(1659890472.969:4): avc:  denied  { unlink } for  pid=26 comm=&quot;kdevtmpfs&quot; name=&quot;fb0&quot; dev=&quot;devtmpfs&quot; ino=152 scontext=system_u:system_r:kernel_t:s0 tcontext=system_u:object_r:framebuf_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= kernel_t ==============</span>
allow kernel_t framebuf_device_t:chr_file <span class="o">{</span> setattr unlink <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow kernel_t framebuf_device_t:chr_file { setattr unlink };&quot;</span> -c my_000007

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># [   38.924284] audit: type=1400 audit(1659892115.476:7): avc:  denied  { getattr } for  pid=3351 comm=&quot;loadkeys&quot; path=&quot;/root&quot; dev=&quot;dm-2&quot; ino=67027 scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:default_t:s0 tclass=dir permissive=0</span>

<span class="c1"># fcontext under &quot;strict&quot;</span>
<span class="c1"># semanage fcontext -l | grep &quot;^/root&quot;</span>
❯ <span class="nv">my_fcontext</span><span class="o">=</span><span class="s2">&quot;/root                                              directory          root:object_r:user_home_dir_t</span>
<span class="s2">/root/((www)|(web)|(public_html))(/.*)?/\.htaccess regular file       root:object_r:httpd_user_htaccess_t</span>
<span class="s2">/root/((www)|(web)|(public_html))(/.*)?/logs(/.*)? all files          root:object_r:httpd_user_ra_content_t</span>
<span class="s2">/root/((www)|(web)|(public_html))(/.+)?            all files          root:object_r:httpd_user_content_t</span>
<span class="s2">/root/((www)|(web)|(public_html))/cgi-bin(/.+)?    all files          root:object_r:httpd_user_script_exec_t</span>
<span class="s2">/root/.+                                           all files          root:object_r:user_home_t</span>
<span class="s2">/root/Documents(/.*)?                              all files          root:object_r:xdg_documents_t</span>
<span class="s2">/root/DovecotMail(/.*)?                            all files          root:object_r:mail_home_rw_t</span>
<span class="s2">/root/Downloads(/.*)?                              all files          root:object_r:xdg_downloads_t</span>
<span class="s2">/root/Maildir(/.*)?                                all files          root:object_r:mail_home_rw_t</span>
<span class="s2">/root/Music(/.*)?                                  all files          root:object_r:xdg_music_t</span>
<span class="s2">/root/Pictures(/.*)?                               all files          root:object_r:xdg_pictures_t</span>
<span class="s2">/root/Videos(/.*)?                                 all files          root:object_r:xdg_videos_t</span>
<span class="s2">/root/\.cache(/.*)?                                all files          root:object_r:xdg_cache_t</span>
<span class="s2">/root/\.config(/.*)?                               all files          root:object_r:xdg_config_t</span>
<span class="s2">/root/\.config/git(/.*)?                           all files          root:object_r:git_xdg_config_t</span>
<span class="s2">/root/\.config/systemd(/.*)?                       all files          root:object_r:systemd_conf_home_t</span>
<span class="s2">/root/\.config/tmux(/.*)?                          regular file       root:object_r:screen_home_t</span>
<span class="s2">/root/\.dbus(/.*)?                                 all files          root:object_r:session_dbusd_home_t</span>
<span class="s2">/root/\.default_contexts                           regular file       system_u:object_r:default_context_t</span>
<span class="s2">/root/\.esmtp_queue                                regular file       root:object_r:mail_home_t</span>
<span class="s2">/root/\.forward[^/]*                               regular file       root:object_r:mail_home_t</span>
<span class="s2">/root/\.gitconfig                                  regular file       root:object_r:git_xdg_config_t</span>
<span class="s2">/root/\.gnupg(/.+)?                                all files          root:object_r:gpg_secret_t</span>
<span class="s2">/root/\.gnupg/S\.gpg-agent.*                       socket             root:object_r:gpg_agent_tmp_t</span>
<span class="s2">/root/\.gnupg/S\.scdaemon                          socket             root:object_r:gpg_agent_tmp_t</span>
<span class="s2">/root/\.gnupg/crls\.d(/.+)?                        all files          root:object_r:dirmngr_home_t</span>
<span class="s2">/root/\.gnupg/log-socket                           socket             root:object_r:gpg_agent_tmp_t</span>
<span class="s2">/root/\.k5login                                    regular file       root:object_r:krb5_home_t</span>
<span class="s2">/root/\.local(/.*)?                                all files          root:object_r:xdg_data_t</span>
<span class="s2">/root/\.local/bin(/.*)?                            all files          root:object_r:user_bin_t</span>
<span class="s2">/root/\.local/share/systemd(/.*)?                  all files          root:object_r:systemd_data_home_t</span>
<span class="s2">/root/\.maildir(/.*)?                              all files          root:object_r:mail_home_rw_t</span>
<span class="s2">/root/\.mailrc                                     regular file       root:object_r:mail_home_t</span>
<span class="s2">/root/\.msmtprc                                    regular file       root:object_r:mail_home_t</span>
<span class="s2">/root/\.pki(/.*)?                                  all files          root:object_r:user_cert_t</span>
<span class="s2">/root/\.screen(/.*)?                               all files          root:object_r:screen_home_t</span>
<span class="s2">/root/\.screenrc                                   regular file       root:object_r:screen_home_t</span>
<span class="s2">/root/\.ssh(/.*)?                                  all files          root:object_r:ssh_home_t</span>
<span class="s2">/root/\.tmux\.conf                                 regular file       root:object_r:screen_home_t</span>
<span class="s2">/root/bin(/.*)?                                    all files          root:object_r:user_bin_t</span>
<span class="s2">/root/dead\.letter                                 regular file       root:object_r:mail_home_t</span>
<span class="s2">/root/public_git(/.*)?                             all files          root:object_r:git_user_content_t&quot;</span>

❯ <span class="k">while</span> <span class="nb">read</span> -r line<span class="p">;</span> <span class="k">do</span>
    <span class="k">case</span> <span class="k">$(</span>awk <span class="s1">&#39;{print $2}&#39;</span> <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span> <span class="k">in</span>
        regular<span class="o">)</span>
            <span class="nv">file_type</span><span class="o">=</span><span class="s2">&quot;f&quot;</span><span class="p">;;</span>
        directory<span class="o">)</span>
            <span class="nv">file_type</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">;;</span>
        character<span class="o">)</span>
            <span class="nv">file_type</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">;;</span>
        block<span class="o">)</span>
            <span class="nv">file_type</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">;;</span>
        socket<span class="o">)</span>
            <span class="nv">file_type</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">;;</span>
        symbolic<span class="o">)</span>
            <span class="nv">file_type</span><span class="o">=</span><span class="s2">&quot;l&quot;</span><span class="p">;;</span>
        named<span class="o">)</span>
            <span class="nv">file_type</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">;;</span>
        all<span class="o">)</span>
            <span class="nv">file_type</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">;;</span>
    <span class="k">esac</span>

    <span class="nv">selinux_user</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>awk -F<span class="s1">&#39;:&#39;</span> <span class="s1">&#39;{print $(NF-2)}&#39;</span> <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">line</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $NF}&#39;</span><span class="k">)</span><span class="s2">&quot;</span>
    <span class="nv">selinux_type</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>awk -F<span class="s1">&#39;:&#39;</span> <span class="s1">&#39;{print $NF}&#39;</span> <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>
    <span class="nv">path</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>awk <span class="s1">&#39;{print $1}&#39;</span> <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>

    semanage fcontext -a -f <span class="s2">&quot;</span><span class="si">${</span><span class="nv">file_type</span><span class="si">}</span><span class="s2">&quot;</span> -s <span class="s2">&quot;</span><span class="si">${</span><span class="nv">selinux_user</span><span class="si">}</span><span class="s2">&quot;</span> -t <span class="s2">&quot;</span><span class="si">${</span><span class="nv">selinux_type</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">path</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">||</span> <span class="se">\</span>
    semanage fcontext -m -f <span class="s2">&quot;</span><span class="si">${</span><span class="nv">file_type</span><span class="si">}</span><span class="s2">&quot;</span> -s <span class="s2">&quot;</span><span class="si">${</span><span class="nv">selinux_user</span><span class="si">}</span><span class="s2">&quot;</span> -t <span class="s2">&quot;</span><span class="si">${</span><span class="nv">selinux_type</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">path</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">done</span> <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">my_fcontext</span><span class="si">}</span><span class="s2">&quot;</span>

❯ restorecon -RFv /root
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   40.218232] audit: type=1400 audit(1659904082.793:3): avc:  denied  { read write } for  pid=1 comm=&quot;systemd&quot; name=&quot;rfkill&quot; dev=&quot;devtmpfs&quot; ino=178 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:wireless_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">[   39.054725] audit: type=1400 audit(1659906160.603:3): avc:  denied  { open } for  pid=1 comm=&quot;systemd&quot; path=&quot;/dev/rfkill&quot; dev=&quot;devtmpfs&quot; ino=178 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:wireless_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t wireless_device_t:chr_file <span class="o">{</span> open <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t wireless_device_t:chr_file { open read write };&quot;</span> -c my_000008

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   39.048851] audit: type=1400 audit(1659906509.586:3): avc:  denied  { execute } for  pid=3175 comm=&quot;(bootctl)&quot; name=&quot;bootctl&quot; dev=&quot;dm-1&quot; ino=2234398 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:bootloader_exec_t:s0 tclass=file permissive=0</span>
<span class="s">[   39.132364] audit: type=1400 audit(1659907055.619:3): avc:  denied  { read open } for  pid=3167 comm=&quot;(bootctl)&quot; path=&quot;/usr/bin/bootctl&quot; dev=&quot;dm-3&quot; ino=2234398 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:bootloader_exec_t:s0 tclass=file permissive=0</span>
<span class="s">[   39.413367] audit: type=1400 audit(1659908226.933:3): avc:  denied  { execute_no_trans } for  pid=3470 comm=&quot;(bootctl)&quot; path=&quot;/usr/bin/bootctl&quot; dev=&quot;dm-0&quot; ino=2234398 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:bootloader_exec_t:s0 tclass=file permissive=0</span>
<span class="s">[   40.029697] audit: type=1400 audit(1659908634.563:3): avc:  denied  { map } for  pid=3473 comm=&quot;bootctl&quot; path=&quot;/usr/bin/bootctl&quot; dev=&quot;dm-0&quot; ino=2234398 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:bootloader_exec_t:s0 tclass=file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t bootloader_exec_t:file <span class="o">{</span> execute execute_no_trans map open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t bootloader_exec_t:file { execute execute_no_trans map open read };&quot;</span> -c my_000009

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   40.774118] audit: type=1400 audit(1659904083.350:6): avc:  denied  { getattr } for  pid=3282 comm=&quot;systemd-tmpfile&quot; path=&quot;/var/cache/eix&quot; dev=&quot;dm-0&quot; ino=76668 scontext=system_u:system_r:systemd_tmpfiles_t:s0 tcontext=system_u:object_r:portage_cache_t:s0 tclass=dir permissive=0</span>
<span class="s">[   40.779591] audit: type=1400 audit(1659904083.350:7): avc:  denied  { read } for  pid=3282 comm=&quot;systemd-tmpfile&quot; name=&quot;eix&quot; dev=&quot;dm-0&quot; ino=76668 scontext=system_u:system_r:systemd_tmpfiles_t:s0 tcontext=system_u:object_r:portage_cache_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= systemd_tmpfiles_t ==============</span>

<span class="c1">#!!!! This avc can be allowed using the boolean &#39;systemd_tmpfiles_manage_all&#39;</span>
allow systemd_tmpfiles_t portage_cache_t:dir <span class="o">{</span> getattr <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ setsebool -P systemd_tmpfiles_manage_all on
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   40.289519] audit: type=1400 audit(1659909973.819:3): avc:  denied  { mounton } for  pid=3379 comm=&quot;(resolved)&quot; path=&quot;/run/systemd/unit-root/run/systemd/resolve&quot; dev=&quot;tmpfs&quot; ino=1544 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_resolved_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>

<span class="c1">#!!!! This avc can be allowed using the boolean &#39;init_mounton_non_security&#39;</span>
allow init_t systemd_resolved_runtime_t:dir mounton<span class="p">;</span>

❯ setsebool -P init_mounton_non_security on
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># [   39.984771] audit: type=1400 audit(1659910969.506:3): avc:  denied  { getattr } for  pid=3292 comm=&quot;nft&quot; path=&quot;/var/lib/nftables/rules-save&quot; dev=&quot;dm-0&quot; ino=2333394 scontext=system_u:system_r:iptables_t:s0 tcontext=system_u:object_r:var_lib_t:s0 tclass=file permissive=0</span>

❯ semanage fcontext -l <span class="p">|</span> grep -i <span class="s2">&quot;/var/lib&quot;</span> <span class="p">|</span> grep tables <span class="p">|</span> column -t
/var/lib/ip6?tables<span class="o">(</span>/.*<span class="o">)</span>?  all  files  system_u:object_r:initrc_tmp_t:s0

❯ semanage fcontext -a -f a -s system_u -t initrc_tmp_t <span class="s1">&#39;/var/lib/nftables(/[^\.].*)?&#39;</span>

❯ restorecon -RFv /var/lib/nftables
Relabeled /var/lib/nftables from system_u:object_r:var_lib_t:s0 to system_u:object_r:initrc_tmp_t:s0
Relabeled /var/lib/nftables/rules-save from system_u:object_r:var_lib_t:s0 to system_u:object_r:initrc_tmp_t:s0
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   40.155132] audit: type=1400 audit(1659912307.676:3): avc:  denied  { read } for  pid=3318 comm=&quot;systemd-network&quot; name=&quot;network&quot; dev=&quot;tmpfs&quot; ino=78 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">[   40.558773] audit: type=1400 audit(1659912839.089:3): avc:  denied  { getattr } for  pid=3309 comm=&quot;systemd-network&quot; path=&quot;/run/systemd/network/90-enp1s0.network&quot; dev=&quot;tmpfs&quot; ino=80 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">[   49.671301] audit: type=1400 audit(1660397172.236:3): avc:  denied  { read } for  pid=3507 comm=&quot;systemd-network&quot; name=&quot;90-enp1s0.network&quot; dev=&quot;tmpfs&quot; ino=80 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">[   40.820487] audit: type=1400 audit(1660397629.459:3): avc:  denied  { open } for  pid=3305 comm=&quot;systemd-network&quot; path=&quot;/run/systemd/network/90-enp1s0.network&quot; dev=&quot;tmpfs&quot; ino=79 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">[   40.436302] audit: type=1400 audit(1660398037.003:3): avc:  denied  { ioctl } for  pid=3304 comm=&quot;systemd-network&quot; path=&quot;/run/systemd/network/90-enp1s0.network&quot; dev=&quot;tmpfs&quot; ino=79 ioctlcmd=0x5401 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= systemd_networkd_t ==============</span>
allow systemd_networkd_t init_runtime_t:dir read<span class="p">;</span>
allow systemd_networkd_t init_runtime_t:file <span class="o">{</span> getattr ioctl open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow systemd_networkd_t init_runtime_t:dir read;&quot;</span> -c my_000010_dir
❯ selocal -a <span class="s2">&quot;allow systemd_networkd_t init_runtime_t:file { getattr ioctl open read };&quot;</span> -c my_000010_file

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   41.110108] audit: type=1400 audit(1660400958.629:3): avc:  denied  { relabelto } for  pid=3318 comm=&quot;(unbound)&quot; name=&quot;/&quot; dev=&quot;tmpfs&quot; ino=1 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:named_conf_t:s0 tclass=dir permissive=0</span>
<span class="s">[   40.552975] audit: type=1400 audit(1660402251.079:3): avc:  denied  { write } for  pid=3407 comm=&quot;(unbound)&quot; name=&quot;/&quot; dev=&quot;tmpfs&quot; ino=1 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:named_conf_t:s0 tclass=dir permissive=0</span>
<span class="s">[   40.297757] audit: type=1400 audit(1660402820.809:3): avc:  denied  { add_name } for  pid=3306 comm=&quot;(unbound)&quot; name=&quot;log&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:named_conf_t:s0 tclass=dir permissive=0</span>
<span class="s">[   39.927797] audit: type=1400 audit(1660403248.466:3): avc:  denied  { create } for  pid=3415 comm=&quot;(unbound)&quot; name=&quot;log&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:named_conf_t:s0 tclass=file permissive=0</span>
<span class="s">[   39.828873] audit: type=1400 audit(1660403547.326:3): avc:  denied  { create } for  pid=3316 comm=&quot;(unbound)&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:named_conf_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t named_conf_t:dir <span class="o">{</span> add_name create relabelto write <span class="o">}</span><span class="p">;</span>
allow init_t named_conf_t:file create<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t named_conf_t:dir { add_name create relabelto write };&quot;</span> -c my_000011_dir
❯ selocal -a <span class="s2">&quot;allow init_t named_conf_t:file create;&quot;</span> -c my_000011_file

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   56.466014] audit: type=1400 audit(1660417565.086:3): avc:  denied  { watch watch_reads } for  pid=3813 comm=&quot;(agetty)&quot; path=&quot;/dev/tty1&quot; dev=&quot;devtmpfs&quot; ino=20 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:tty_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">[   56.603505] audit: type=1400 audit(1660417565.226:10): avc:  denied  { watch watch_reads } for  pid=3821 comm=&quot;(agetty)&quot; path=&quot;/dev/ttyS0&quot; dev=&quot;devtmpfs&quot; ino=96 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:tty_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">[   56.479764] audit: type=1400 audit(1660417565.103:5): avc:  denied  { setattr } for  pid=1 comm=&quot;systemd&quot; name=&quot;ttyS0&quot; dev=&quot;devtmpfs&quot; ino=96 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:tty_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t tty_device_t:chr_file <span class="o">{</span> setattr watch watch_reads <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t tty_device_t:chr_file { setattr watch watch_reads };&quot;</span> -c my_000012

❯ selocal -b -L
</code></pre></div>
<h3 id="932-inclusion-of-dontaudit-denials">9.3.2. Inclusion of dontaudit denials<a class="headerlink" href="#932-inclusion-of-dontaudit-denials" title="Permanent link">&para;</a></h3>
<p>At this point, a login is still not possible. So, a look has to be taken at those <code>dontaudit</code> denials:</p>
<div class="highlight"><pre><span></span><code>semodule --disable_dontaudit --build
</code></pre></div>
<p>TODO</p>
<div class="highlight"><pre><span></span><code><span class="c1"># [   71.618497] audit: type=1400 audit(1660578688.199:1278): avc:  denied  { getattr } for  pid=3425 comm=&quot;agetty&quot; name=&quot;/&quot; dev=&quot;selinuxfs&quot; ino=1 scontext=system_u:system_r:getty_t:s0 tcontext=system_u:object_r:security_t:s0 tclass=filesystem permissive=0</span>
<span class="c1"># [   71.623287] audit: type=1400 audit(1660578688.199:1279): avc:  denied  { getattr } for  pid=3425 comm=&quot;agetty&quot; name=&quot;/&quot; dev=&quot;selinuxfs&quot; ino=1 scontext=system_u:system_r:getty_t:s0 tcontext=system_u:object_r:security_t:s0 tclass=filesystem permissive=0</span>
<span class="c1"># [   71.626143] audit: type=1400 audit(1660578688.199:1280): avc:  denied  { search } for  pid=3425 comm=&quot;agetty&quot; name=&quot;selinux&quot; dev=&quot;dm-0&quot; ino=1502351 scontext=system_u:system_r:getty_t:s0 tcontext=system_u:object_r:selinux_config_t:s0 tclass=dir permissive=0</span>

❯ selocal -a <span class="s2">&quot;seutil_libselinux_linked(getty_t)&quot;</span> -c my_000013

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[  222.344865] audit: type=1400 audit(1660581538.873:1175): avc:  denied  { use } for  pid=3416 comm=&quot;login&quot; path=&quot;/dev/tty1&quot; dev=&quot;devtmpfs&quot; ino=20 scontext=system_u:system_r:local_login_t:s0 tcontext=system_u:system_r:init_t:s0 tclass=fd permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= local_login_t ==============</span>
allow local_login_t init_t:fd use<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow local_login_t init_t:fd use;&quot;</span> -c my_000014

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[  124.071924] audit: type=1400 audit(1660582456.606:1155): avc:  denied  { noatsecure } for  pid=3437 comm=&quot;agetty&quot; scontext=system_u:system_r:getty_t:s0 tcontext=system_u:system_r:local_login_t:s0 tclass=process permissive=0</span>
<span class="s">[  124.078036] audit: type=1400 audit(1660582456.606:1156): avc:  denied  { rlimitinh } for  pid=3437 comm=&quot;login&quot; scontext=system_u:system_r:getty_t:s0 tcontext=system_u:system_r:local_login_t:s0 tclass=process permissive=0</span>
<span class="s">[  124.080646] audit: type=1400 audit(1660582456.606:1157): avc:  denied  { siginh } for  pid=3437 comm=&quot;login&quot; scontext=system_u:system_r:getty_t:s0 tcontext=system_u:system_r:local_login_t:s0 tclass=process permissive=0</span>
<span class="s">[  124.087761] audit: type=1400 audit(1660582456.619:1158): avc:  denied  { noatsecure } for  pid=3440 comm=&quot;login&quot; scontext=system_u:system_r:local_login_t:s0 tcontext=system_u:system_r:chkpwd_t:s0 tclass=process permissive=0</span>
<span class="s">[  124.090289] audit: type=1400 audit(1660582456.619:1159): avc:  denied  { read write } for  pid=3440 comm=&quot;unix_chkpwd&quot; path=&quot;/dev/tty1&quot; dev=&quot;devtmpfs&quot; ino=20 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:tty_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">[  124.093821] audit: type=1400 audit(1660582456.619:1160): avc:  denied  { rlimitinh } for  pid=3440 comm=&quot;unix_chkpwd&quot; scontext=system_u:system_r:local_login_t:s0 tcontext=system_u:system_r:chkpwd_t:s0 tclass=process permissive=0</span>
<span class="s">[  124.096133] audit: type=1400 audit(1660582456.619:1161): avc:  denied  { siginh } for  pid=3440 comm=&quot;unix_chkpwd&quot; scontext=system_u:system_r:local_login_t:s0 tcontext=system_u:system_r:chkpwd_t:s0 tclass=process permissive=0</span>
<span class="s">[  124.099480] audit: type=1400 audit(1660582456.619:1162): avc:  denied  { search } for  pid=3440 comm=&quot;unix_chkpwd&quot; name=&quot;kernel&quot; dev=&quot;proc&quot; ino=12981 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:sysctl_kernel_t:s0 tclass=dir permissive=0</span>

<span class="s">[  110.728797] audit: type=1400 audit(1660582883.253:843): avc:  denied  { read } for  pid=3216 comm=&quot;unix_chkpwd&quot; name=&quot;cap_last_cap&quot; dev=&quot;proc&quot; ino=13046 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:sysctl_kernel_t:s0 tclass=file permissive=0</span>

<span class="s">[  133.281256] audit: type=1400 audit(1660582905.806:844): avc:  denied  { read } for  pid=3217 comm=&quot;unix_chkpwd&quot; name=&quot;cap_last_cap&quot; dev=&quot;proc&quot; ino=13046 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:sysctl_kernel_t:s0 tclass=file permissive=0</span>
<span class="s">[  133.296342] audit: type=1400 audit(1660582905.819:845): avc:  denied  { read } for  pid=3218 comm=&quot;unix_chkpwd&quot; name=&quot;cap_last_cap&quot; dev=&quot;proc&quot; ino=13046 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:sysctl_kernel_t:s0 tclass=file permissive=0</span>
<span class="s">[  133.301187] audit: type=1400 audit(1660582905.826:846): avc:  denied  { net_admin } for  pid=3214 comm=&quot;login&quot; capability=12  scontext=system_u:system_r:local_login_t:s0 tcontext=system_u:system_r:local_login_t:s0 tclass=capability permissive=0</span>
<span class="s">[  133.304066] audit: type=1400 audit(1660582905.826:847): avc:  denied  { net_admin } for  pid=3214 comm=&quot;login&quot; capability=12  scontext=system_u:system_r:local_login_t:s0 tcontext=system_u:system_r:local_login_t:s0 tclass=capability permissive=0</span>
<span class="s">[  133.313264] audit: type=1400 audit(1660582905.836:848): avc:  denied  { noatsecure } for  pid=3219 comm=&quot;(time-dir)&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:systemd_user_runtime_dir_t:s0 tclass=process permissive=0</span>
<span class="s">[  133.316042] audit: type=1400 audit(1660582905.836:849): avc:  denied  { getattr } for  pid=3219 comm=&quot;systemd-user-ru&quot; name=&quot;/&quot; dev=&quot;proc&quot; ino=1 scontext=system_u:system_r:systemd_user_runtime_dir_t:s0 tcontext=system_u:object_r:proc_t:s0 tclass=filesystem permissive=0</span>
<span class="s">[  133.320670] audit: type=1400 audit(1660582905.839:850): avc:  denied  { read } for  pid=3191 comm=&quot;systemd-logind&quot; name=&quot;snd\x2fseq&quot; dev=&quot;tmpfs&quot; ino=906 scontext=system_u:system_r:systemd_logind_t:s0 tcontext=system_u:object_r:udev_runtime_t:s0 tclass=lnk_file permissive=0</span>
<span class="s">[  133.324261] audit: type=1400 audit(1660582905.839:851): avc:  denied  { read } for  pid=3191 comm=&quot;systemd-logind&quot; name=&quot;snd\x2ftimer&quot; dev=&quot;tmpfs&quot; ino=905 scontext=system_u:system_r:systemd_logind_t:s0 tcontext=system_u:object_r:udev_runtime_t:s0 tclass=lnk_file permissive=0</span>
<span class="s">[  133.329278] audit: type=1400 audit(1660582905.839:852): avc:  denied  { net_admin } for  pid=3219 comm=&quot;systemd-user-ru&quot; capability=12  scontext=system_u:system_r:systemd_user_runtime_dir_t:s0 tcontext=system_u:system_r:systemd_user_runtime_dir_t:s0 tclass=capability permissive=0</span>
<span class="s">[  133.334078] audit: type=1400 audit(1660582905.839:853): avc:  denied  { net_admin } for  pid=3219 comm=&quot;systemd-user-ru&quot; capability=12  scontext=system_u:system_r:systemd_user_runtime_dir_t:s0 tcontext=system_u:system_r:systemd_user_runtime_dir_t:s0 tclass=capability permissive=0</span>

<span class="s">[  131.404386] audit: type=1400 audit(1660584690.896:1422): avc:  denied  { open } for  pid=3324 comm=&quot;unix_chkpwd&quot; path=&quot;/proc/sys/kernel/cap_last_cap&quot; dev=&quot;proc&quot; ino=12585 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:sysctl_kernel_t:s0 tclass=file permissive=0</span>
<span class="s">[  136.103421] audit: type=1400 audit(1660584695.596:1423): avc:  denied  { open } for  pid=3325 comm=&quot;unix_chkpwd&quot; path=&quot;/proc/sys/kernel/cap_last_cap&quot; dev=&quot;proc&quot; ino=12585 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:sysctl_kernel_t:s0 tclass=file permissive=0</span>
<span class="s">[  136.117257] audit: type=1400 audit(1660584695.609:1424): avc:  denied  { open } for  pid=3326 comm=&quot;unix_chkpwd&quot; path=&quot;/proc/sys/kernel/cap_last_cap&quot; dev=&quot;proc&quot; ino=12585 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:sysctl_kernel_t:s0 tclass=file permissive=0</span>
<span class="s">[  136.143945] audit: type=1400 audit(1660584695.636:1425): avc:  denied  { noatsecure } for  pid=3329 comm=&quot;(systemd)&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:chkpwd_t:s0 tclass=process permissive=0</span>
<span class="s">[  136.145948] audit: type=1400 audit(1660584695.639:1426): avc:  denied  { rlimitinh } for  pid=3329 comm=&quot;unix_chkpwd&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:chkpwd_t:s0 tclass=process permissive=0</span>
<span class="s">[  136.147659] audit: type=1400 audit(1660584695.639:1427): avc:  denied  { siginh } for  pid=3329 comm=&quot;unix_chkpwd&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:chkpwd_t:s0 tclass=process permissive=0</span>
<span class="s">[  136.150332] audit: type=1400 audit(1660584695.639:1428): avc:  denied  { open } for  pid=3329 comm=&quot;unix_chkpwd&quot; path=&quot;/proc/sys/kernel/cap_last_cap&quot; dev=&quot;proc&quot; ino=12585 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:sysctl_kernel_t:s0 tclass=file permissive=0</span>
<span class="s">[  136.162414] audit: type=1400 audit(1660584695.656:1429): avc:  denied  { write } for  pid=3328 comm=&quot;systemd&quot; name=&quot;/&quot; dev=&quot;tmpfs&quot; ino=1 scontext=system_u:system_r:init_t:s0 tcontext=unconfined_u:object_r:user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">[  136.171271] audit: type=1400 audit(1660584695.659:1430): avc:  denied  { write } for  pid=3328 comm=&quot;systemd&quot; name=&quot;/&quot; dev=&quot;tmpfs&quot; ino=1 scontext=system_u:system_r:init_t:s0 tcontext=unconfined_u:object_r:user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">[  136.219065] audit: type=1400 audit(1660584695.713:1431): avc:  denied  { noatsecure } for  pid=3331 comm=&quot;(agetty)&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:getty_t:s0 tclass=process permissive=0</span>

<span class="s">[   92.191870] audit: type=1400 audit(1660586439.683:1367): avc:  denied  { getattr } for  pid=3316 comm=&quot;unix_chkpwd&quot; name=&quot;/&quot; dev=&quot;proc&quot; ino=1 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:proc_t:s0 tclass=filesystem permissive=0</span>
<span class="s">[   95.543102] audit: type=1400 audit(1660586443.033:1368): avc:  denied  { getattr } for  pid=3317 comm=&quot;unix_chkpwd&quot; name=&quot;/&quot; dev=&quot;proc&quot; ino=1 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:proc_t:s0 tclass=filesystem permissive=0</span>
<span class="s">[   95.556354] audit: type=1400 audit(1660586443.046:1369): avc:  denied  { getattr } for  pid=3318 comm=&quot;unix_chkpwd&quot; name=&quot;/&quot; dev=&quot;proc&quot; ino=1 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:proc_t:s0 tclass=filesystem permissive=0</span>
<span class="s">[   95.586875] audit: type=1400 audit(1660586443.079:1370): avc:  denied  { getattr } for  pid=3321 comm=&quot;unix_chkpwd&quot; name=&quot;/&quot; dev=&quot;proc&quot; ino=1 scontext=system_u:system_r:chkpwd_t:s0 tcontext=system_u:object_r:proc_t:s0 tclass=filesystem permissive=0</span>
<span class="s">[   95.598046] audit: type=1400 audit(1660586443.089:1371): avc:  denied  { add_name } for  pid=3320 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=unconfined_u:object_r:user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">[   95.600191] audit: type=1400 audit(1660586443.093:1372): avc:  denied  { add_name } for  pid=3320 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=unconfined_u:object_r:user_runtime_t:s0 tclass=dir permissive=0</span>

<span class="s">[   81.748661] audit: type=1400 audit(1660587572.186:1246): avc:  denied  { create } for  pid=3535 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=unconfined_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">[   81.750973] audit: type=1400 audit(1660587572.186:1247): avc:  denied  { create } for  pid=3535 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=unconfined_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= chkpwd_t ==============</span>
allow chkpwd_t proc_t:filesystem getattr<span class="p">;</span>
allow chkpwd_t sysctl_kernel_t:dir search<span class="p">;</span>
allow chkpwd_t sysctl_kernel_t:file <span class="o">{</span> open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>
allow chkpwd_t tty_device_t:chr_file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>

<span class="c1">#============= getty_t ==============</span>
allow getty_t local_login_t:process <span class="o">{</span> noatsecure rlimitinh siginh <span class="o">}</span><span class="p">;</span>

<span class="c1">#============= init_t ==============</span>
allow init_t chkpwd_t:process <span class="o">{</span> noatsecure rlimitinh siginh <span class="o">}</span><span class="p">;</span>
allow init_t getty_t:process noatsecure<span class="p">;</span>
allow init_t systemd_user_runtime_dir_t:process noatsecure<span class="p">;</span>
allow init_t user_runtime_t:dir <span class="o">{</span> add_name write <span class="o">}</span><span class="p">;</span>
allow init_t systemd_user_runtime_t:dir create<span class="p">;</span>

<span class="c1">#============= local_login_t ==============</span>
allow local_login_t chkpwd_t:process <span class="o">{</span> noatsecure rlimitinh siginh <span class="o">}</span><span class="p">;</span>
allow local_login_t self:capability net_admin<span class="p">;</span>

<span class="c1">#============= systemd_logind_t ==============</span>
allow systemd_logind_t udev_runtime_t:lnk_file read<span class="p">;</span>

<span class="c1">#============= systemd_user_runtime_dir_t ==============</span>
allow systemd_user_runtime_dir_t proc_t:filesystem getattr<span class="p">;</span>
allow systemd_user_runtime_dir_t self:capability net_admin<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow chkpwd_t sysctl_kernel_t:dir search;&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow chkpwd_t sysctl_kernel_t:file read;&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow chkpwd_t tty_device_t:chr_file { read write };&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow getty_t local_login_t:process { noatsecure rlimitinh siginh };&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow init_t systemd_user_runtime_dir_t:process noatsecure;&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow local_login_t chkpwd_t:process { noatsecure rlimitinh siginh };&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow local_login_t self:capability net_admin;&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow systemd_logind_t udev_runtime_t:lnk_file read;&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow systemd_user_runtime_dir_t proc_t:filesystem getattr;&quot;</span> -c <span class="s2">&quot;meh&quot;</span>
❯ selocal -a <span class="s2">&quot;allow systemd_user_runtime_dir_t self:capability net_admin;&quot;</span> -c <span class="s2">&quot;meh&quot;</span>

❯ selocal -b -L
</code></pre></div>
<h6 id="meh">meh<a class="headerlink" href="#meh" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | auditallow</span>
<span class="s">[  217.010974] audit: type=1400 audit(1660588383.389:821): avc:  denied  { create } for  pid=3926 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=unconfined_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">[  217.013726] audit: type=1400 audit(1660588383.393:822): avc:  denied  { create } for  pid=3926 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=unconfined_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>
</code></pre></div>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../post-boot_configuration/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 8. Post-Boot Configuration" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              8. Post-Boot Configuration
            </div>
          </div>
        </a>
      
      
        
        <a href="../other_gentoo_linux_repos/" class="md-footer__link md-footer__link--next" aria-label="Next: 10. Other Gentoo Linux repos" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              10. Other Gentoo Linux repos
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>