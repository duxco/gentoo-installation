
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Gentoo installation using Measured Boot, Secure Boot, Full Disk Encryption, RAID and offering a rescue system based on customised SystemRescueCD">
      
      
        <meta name="author" content="David Sardari">
      
      
        <link rel="canonical" href="https://gentoo.duxsco.de/selinux/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.1">
    
    
      
        <title>9. SELinux (optional) - Gentoo Linux Installation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#91-enable-selinux" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Gentoo Linux Installation" class="md-header__button md-logo" aria-label="Gentoo Linux Installation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gentoo Linux Installation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              9. SELinux (optional)
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/duxsco/gentoo-installation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
  </div>
  <div class="md-source__repository">
    duxsco/gentoo-installation
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Gentoo Linux Installation" class="md-nav__button md-logo" aria-label="Gentoo Linux Installation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Gentoo Linux Installation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/duxsco/gentoo-installation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
  </div>
  <div class="md-source__repository">
    duxsco/gentoo-installation
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        1. Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../live-cd_environment/" class="md-nav__link">
        2. Live-CD Environment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disk_setup/" class="md-nav__link">
        3. Disk Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../rescue_system/" class="md-nav__link">
        4. Rescue System
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../chrooting/" class="md-nav__link">
        5. Chrooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../system_setup/" class="md-nav__link">
        6. System Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cleanup_and_reboot/" class="md-nav__link">
        7. Cleanup And Reboot
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../post-boot_configuration/" class="md-nav__link">
        8. Post-Boot Configuration
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          9. SELinux (optional)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        9. SELinux (optional)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#91-enable-selinux" class="md-nav__link">
    9.1. Enable SELinux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#92-relabel" class="md-nav__link">
    9.2. Relabel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#93-users-and-services" class="md-nav__link">
    9.3. Users and services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#94-selinux-policies" class="md-nav__link">
    9.4. SELinux policies
  </a>
  
    <nav class="md-nav" aria-label="9.4. SELinux policies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#941-pre-auditd-denials" class="md-nav__link">
    9.4.1. Pre-auditd denials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#942-auditd-denials" class="md-nav__link">
    9.4.2. auditd denials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../other_gentoo_linux_repos/" class="md-nav__link">
        10. Other Gentoo Linux repos
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#91-enable-selinux" class="md-nav__link">
    9.1. Enable SELinux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#92-relabel" class="md-nav__link">
    9.2. Relabel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#93-users-and-services" class="md-nav__link">
    9.3. Users and services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#94-selinux-policies" class="md-nav__link">
    9.4. SELinux policies
  </a>
  
    <nav class="md-nav" aria-label="9.4. SELinux policies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#941-pre-auditd-denials" class="md-nav__link">
    9.4.1. Pre-auditd denials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#942-auditd-denials" class="md-nav__link">
    9.4.2. auditd denials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/duxsco/gentoo-installation/blob/main/docs/selinux.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>9. SELinux (optional)</h1>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The following covers the SELinux denials from bootup until login via tty/SSH and up to <code>sudo -i</code> into the root account.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I haven't taken a close look at all denials yet. First, I wanted to take care of all denials until I can login successfully. I need to check next whether all policies are necessary and make sure that PAM (see constraint violation below) is working correctly.</p>
</div>
<h2 id="91-enable-selinux">9.1. Enable SELinux<a class="headerlink" href="#91-enable-selinux" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Currently, I only use SELinux on servers, and only <code>mcs</code> policy type to be able to "isolate" virtual machines from each other.</p>
</div>
<p>Prepare for SELinux (copy&amp;paste one after the other):</p>
<div class="highlight"><pre><span></span><code>cp -av /etc/portage/make.conf /etc/portage/._cfg0000_make.conf
<span class="nb">echo</span> -e <span class="s1">&#39;POLICY_TYPES=&quot;mcs&quot;\n&#39;</span> &gt;&gt; /etc/portage/._cfg0000_make.conf
sed -i <span class="s1">&#39;s/^USE_HARDENED=&quot;\(.*\)&quot;/USE_HARDENED=&quot;\1 -unconfined&quot;/&#39;</span> /etc/portage/._cfg0000_make.conf
<span class="c1"># execute dispatch-conf</span>

eselect profile <span class="nb">set</span> --force <span class="m">18</span> <span class="c1"># should be &quot;[18]  default/linux/amd64/17.1/systemd/selinux (exp)&quot;</span>

<span class="nv">FEATURES</span><span class="o">=</span><span class="s2">&quot;-selinux&quot;</span> emerge -1 selinux-base

cp -av /etc/selinux/config /etc/selinux/._cfg0000_config
sed -i <span class="s1">&#39;s/^SELINUXTYPE=strict$/SELINUXTYPE=mcs/&#39;</span> /etc/selinux/._cfg0000_config
<span class="c1"># execute dispatch-conf</span>

<span class="nv">FEATURES</span><span class="o">=</span><span class="s2">&quot;-selinux -sesandbox&quot;</span> emerge -1 selinux-base
<span class="nv">FEATURES</span><span class="o">=</span><span class="s2">&quot;-selinux -sesandbox&quot;</span> emerge -1 selinux-base-policy
emerge -avuDN @world
</code></pre></div>
<p>Enable logging:</p>
<div class="highlight"><pre><span></span><code>systemctl <span class="nb">enable</span> auditd.service
</code></pre></div>
<p>Rebuild the kernel with SELinux support:</p>
<div class="highlight"><pre><span></span><code>emerge sys-kernel/gentoo-kernel-bin <span class="o">&amp;&amp;</span> <span class="se">\</span>
rm -v /boot/efi*/EFI/Linux/gentoo-*-gentoo-dist.efi
</code></pre></div>
<p>Reboot with <code>permissive</code> kernel.</p>
<h2 id="92-relabel">9.2. Relabel<a class="headerlink" href="#92-relabel" title="Permanent link">&para;</a></h2>
<p><a href="https://wiki.gentoo.org/wiki/SELinux/Installation#Relabel">Relabel the entire system</a>:</p>
<div class="highlight"><pre><span></span><code>mkdir /mnt/gentoo <span class="o">&amp;&amp;</span> <span class="se">\</span>
mount -o <span class="nb">bind</span> / /mnt/gentoo <span class="o">&amp;&amp;</span> <span class="se">\</span>
setfiles -r /mnt/gentoo /etc/selinux/mcs/contexts/files/file_contexts /mnt/gentoo/<span class="o">{</span>dev,home,proc,run,sys,tmp,boot/efi*,var/cache/binpkgs,var/cache/distfiles,var/db/repos/gentoo,var/tmp<span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
umount /mnt/gentoo <span class="o">&amp;&amp;</span> <span class="se">\</span>
rlpkg -a -r <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">echo</span> SUCCESS
</code></pre></div>
<p>In the <a href="https://github.com/duxsco/gentoo-installation">custom Gentoo Linux installation</a>, the SSH port has been changed to 50022. This needs to be considered for no SELinux denials to occur:</p>
<div class="highlight"><pre><span></span><code>❯ semanage port -l <span class="p">|</span> grep -e ssh -e Port
SELinux Port Type              Proto    Port Number
ssh_port_t                     tcp      <span class="m">22</span>
❯ semanage port -a -t ssh_port_t -p tcp <span class="m">50022</span>
❯ semanage port -l <span class="p">|</span> grep -e ssh -e Port
SELinux Port Type              Proto    Port Number
ssh_port_t                     tcp      <span class="m">50022</span>, <span class="m">22</span>
</code></pre></div>
<h2 id="93-users-and-services">9.3. Users and services<a class="headerlink" href="#93-users-and-services" title="Permanent link">&para;</a></h2>
<p>Default <code>mcs</code> SELinux <code>login</code> and <code>user</code> settings:</p>
<div class="highlight"><pre><span></span><code>❯ semanage login -l

Login Name           SELinux User         MLS/MCS Range        Service

__default__          user_u               s0-s0                *
root                 root                 s0-s0:c0.c1023       *

❯ semanage user -l

                Labeling   MLS/       MLS/
SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles

root            sysadm     s0         s0-s0:c0.c1023                 staff_r sysadm_r
staff_u         staff      s0         s0-s0:c0.c1023                 staff_r sysadm_r
sysadm_u        sysadm     s0         s0-s0:c0.c1023                 sysadm_r
system_u        user       s0         s0-s0:c0.c1023                 system_r
unconfined_u    unconfined s0         s0-s0:c0.c1023                 unconfined_r
user_u          user       s0         s0                             user_r
</code></pre></div>
<p>Add the initial user to the <a href="https://wiki.gentoo.org/wiki/SELinux/Installation#Define_the_administrator_accounts">administration SELinux user</a>:</p>
<div class="highlight"><pre><span></span><code>semanage login -a -s staff_u david
restorecon -RFv /home/david
bash -c <span class="s1">&#39;echo &quot;%wheel ALL=(ALL) TYPE=sysadm_t ROLE=sysadm_r ALL&quot; | EDITOR=&quot;tee&quot; visudo -f /etc/sudoers.d/wheel; echo $?&#39;</span>
</code></pre></div>
<p>Now, we should have:</p>
<div class="highlight"><pre><span></span><code>❯ semanage login -l

Login Name           SELinux User         MLS/MCS Range        Service

__default__          user_u               s0-s0                *
david                staff_u              s0-s0:c0.c1023       *
root                 root                 s0-s0:c0.c1023       *
</code></pre></div>
<h2 id="94-selinux-policies">9.4. SELinux policies<a class="headerlink" href="#94-selinux-policies" title="Permanent link">&para;</a></h2>
<h3 id="941-pre-auditd-denials">9.4.1. Pre-auditd denials<a class="headerlink" href="#941-pre-auditd-denials" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The following denials were retrieved from <code>dmesg</code>.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># [   37.545369] audit: type=1400 audit(1661366541.083:3): avc:  denied  { read } for  pid=2999 comm=&quot;10-gentoo-path&quot; name=&quot;profile.env&quot; dev=&quot;dm-1&quot; ino=217358 scontext=system_u:system_r:systemd_generator_t:s0 tcontext=system_u:object_r:etc_runtime_t:s0 tclass=file permissive=0</span>

❯ find / -inum <span class="m">217358</span>
/etc/profile.env

❯ semanage fcontext -l <span class="p">|</span> grep <span class="s1">&#39;/etc/profile\\\.env&#39;</span> <span class="p">|</span> column -t
/etc/profile<span class="se">\.</span>env  regular  file  system_u:object_r:etc_runtime_t:s0

❯ sesearch -A -s systemd_generator_t -c file -p <span class="nb">read</span> <span class="p">|</span> grep etc
allow systemd_generator_t etc_t:file <span class="o">{</span> getattr ioctl lock open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>
allow systemd_generator_t lvm_etc_t:file <span class="o">{</span> getattr ioctl lock map open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ semanage fcontext -m -f f -t etc_t <span class="s1">&#39;/etc/profile\.env&#39;</span>

❯ restorecon -Fv /etc/profile.env
Relabeled /etc/profile.env from system_u:object_r:etc_runtime_t:s0 to system_u:object_r:etc_t:s0
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   37.726930] audit: type=1400 audit(1661366541.263:4): avc:  denied  { create } for  pid=1 comm=&quot;systemd&quot; name=&quot;io.systemd.NameServiceSwitch&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_userdbd_runtime_t:s0 tclass=lnk_file permissive=0</span>
<span class="s">[   37.726917] systemd[1]: systemd-userdbd.socket: Failed to create symlink /run/systemd/userdb/io.systemd.Multiplexer → /run/systemd/userdb/io.systemd.NameServiceSwitch, ignoring: Permission denied</span>
<span class="s">[   37.729729] systemd[1]: systemd-userdbd.socket: Failed to create symlink /run/systemd/userdb/io.systemd.Multiplexer → /run/systemd/userdb/io.systemd.DropIn, ignoring: Permission denied</span>
<span class="s">[   37.732899] audit: type=1400 audit(1661366541.269:5): avc:  denied  { create } for  pid=1 comm=&quot;systemd&quot; name=&quot;io.systemd.DropIn&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_userdbd_runtime_t:s0 tclass=lnk_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t systemd_userdbd_runtime_t:lnk_file create<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t systemd_userdbd_runtime_t:lnk_file create;&quot;</span> -c my_dmesg_000000

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   37.796200] audit: type=1400 audit(1661367313.330:3): avc:  denied  { mounton } for  pid=3224 comm=&quot;(-userdbd)&quot; path=&quot;/run/systemd/unit-root/proc&quot; dev=&quot;dm-0&quot; ino=67139 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:unlabeled_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t unlabeled_t:dir mounton<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t unlabeled_t:dir mounton;&quot;</span> -c my_dmesg_000001

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.036245] audit: type=1400 audit(1661366541.573:6): avc:  denied  { write } for  pid=3039 comm=&quot;systemd-udevd&quot; name=&quot;systemd-udevd.service&quot; dev=&quot;cgroup2&quot; ino=2051 scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:cgroup_t:s0 tclass=dir permissive=0</span>
<span class="s">[   37.962046] audit: type=1400 audit(1661367313.496:8): avc:  denied  { add_name } for  pid=3235 comm=&quot;systemd-udevd&quot; name=&quot;udev&quot; scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:cgroup_t:s0 tclass=dir permissive=0</span>
<span class="s">[   37.054171] audit: type=1400 audit(1661367691.596:3): avc:  denied  { create } for  pid=3126 comm=&quot;systemd-udevd&quot; name=&quot;udev&quot; scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:cgroup_t:s0 tclass=dir permissive=0</span>
<span class="s">[   36.687743] audit: type=1400 audit(1661368167.216:3): avc:  denied  { write } for  pid=3125 comm=&quot;systemd-udevd&quot; name=&quot;cgroup.procs&quot; dev=&quot;cgroup2&quot; ino=2119 scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:cgroup_t:s0 tclass=file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= udev_t ==============</span>
allow udev_t cgroup_t:dir <span class="o">{</span> add_name create write <span class="o">}</span><span class="p">;</span>
allow udev_t cgroup_t:file write<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow udev_t cgroup_t:dir { add_name create write };&quot;</span> -c my_dmesg_000002_dir

❯ selocal -a <span class="s2">&quot;allow udev_t cgroup_t:file write;&quot;</span> -c my_dmesg_000002_file

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.044041] audit: type=1400 audit(1661366541.579:7): avc:  denied  { read } for  pid=3039 comm=&quot;systemd-udevd&quot; name=&quot;network&quot; dev=&quot;tmpfs&quot; ino=78 scontext=system_u:system_r:udev_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= udev_t ==============</span>
allow udev_t init_runtime_t:dir read<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow udev_t init_runtime_t:dir read;&quot;</span> -c my_dmesg_000003

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.129178] audit: type=1400 audit(1661366541.666:9): avc:  denied  { getattr } for  pid=3051 comm=&quot;mdadm&quot; path=&quot;/run/udev&quot; dev=&quot;tmpfs&quot; ino=71 scontext=system_u:system_r:mdadm_t:s0 tcontext=system_u:object_r:udev_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= mdadm_t ==============</span>
allow mdadm_t udev_runtime_t:dir getattr<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow mdadm_t udev_runtime_t:dir getattr;&quot;</span> -c my_dmesg_000004

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.143600] audit: type=1400 audit(1661366541.679:10): avc:  denied  { search } for  pid=3051 comm=&quot;mdadm&quot; name=&quot;block&quot; dev=&quot;debugfs&quot; ino=29 scontext=system_u:system_r:mdadm_t:s0 tcontext=system_u:object_r:debugfs_t:s0 tclass=dir permissive=0</span>
<span class="s">[   38.169458] audit: type=1400 audit(1661366541.683:11): avc:  denied  { search } for  pid=3051 comm=&quot;mdadm&quot; name=&quot;bdi&quot; dev=&quot;debugfs&quot; ino=22 scontext=system_u:system_r:mdadm_t:s0 tcontext=system_u:object_r:debugfs_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= mdadm_t ==============</span>
allow mdadm_t debugfs_t:dir search<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow mdadm_t debugfs_t:dir search;&quot;</span> -c my_dmesg_000005

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.102386] audit: type=1400 audit(1661367313.636:9): avc:  denied  { getattr } for  pid=26 comm=&quot;kdevtmpfs&quot; path=&quot;/fb0&quot; dev=&quot;devtmpfs&quot; ino=152 scontext=system_u:system_r:kernel_t:s0 tcontext=system_u:object_r:framebuf_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= kernel_t ==============</span>
allow kernel_t framebuf_device_t:chr_file getattr<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow kernel_t framebuf_device_t:chr_file getattr;&quot;</span> -c my_dmesg_000006

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   37.167114] audit: type=1400 audit(1661367691.709:4): avc:  denied  { setattr } for  pid=26 comm=&quot;kdevtmpfs&quot; name=&quot;fb0&quot; dev=&quot;devtmpfs&quot; ino=152 scontext=system_u:system_r:kernel_t:s0 tcontext=system_u:object_r:framebuf_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">[   37.191217] audit: type=1400 audit(1661367691.709:5): avc:  denied  { unlink } for  pid=26 comm=&quot;kdevtmpfs&quot; name=&quot;fb0&quot; dev=&quot;devtmpfs&quot; ino=152 scontext=system_u:system_r:kernel_t:s0 tcontext=system_u:object_r:framebuf_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= kernel_t ==============</span>
allow kernel_t framebuf_device_t:chr_file <span class="o">{</span> setattr unlink <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow kernel_t framebuf_device_t:chr_file { setattr unlink };&quot;</span> -c my_dmesg_000007

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.226602] audit: type=1400 audit(1661367313.759:10): avc:  denied  { read write } for  pid=1 comm=&quot;systemd&quot; name=&quot;rfkill&quot; dev=&quot;devtmpfs&quot; ino=178 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:wireless_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">[   37.280830] audit: type=1400 audit(1661367691.823:6): avc:  denied  { open } for  pid=1 comm=&quot;systemd&quot; path=&quot;/dev/rfkill&quot; dev=&quot;devtmpfs&quot; ino=178 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:wireless_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t wireless_device_t:chr_file <span class="o">{</span> open <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t wireless_device_t:chr_file { open read write };&quot;</span> -c my_dmesg_000008

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   38.701549] audit: type=1400 audit(1661367314.236:11): avc:  denied  { execute } for  pid=3307 comm=&quot;(bootctl)&quot; name=&quot;bootctl&quot; dev=&quot;dm-0&quot; ino=186106 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:bootloader_exec_t:s0 tclass=file permissive=0</span>
<span class="s">[   37.857611] audit: type=1400 audit(1661367692.393:7): avc:  denied  { read open } for  pid=3198 comm=&quot;(bootctl)&quot; path=&quot;/usr/bin/bootctl&quot; dev=&quot;dm-0&quot; ino=186106 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:bootloader_exec_t:s0 tclass=file permissive=0</span>
<span class="s">[   37.524074] audit: type=1400 audit(1661368168.053:4): avc:  denied  { execute_no_trans } for  pid=3197 comm=&quot;(bootctl)&quot; path=&quot;/usr/bin/bootctl&quot; dev=&quot;dm-3&quot; ino=186106 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:bootloader_exec_t:s0 tclass=file permissive=0</span>
<span class="s">[   37.776422] audit: type=1400 audit(1661368671.299:3): avc:  denied  { map } for  pid=3202 comm=&quot;bootctl&quot; path=&quot;/usr/bin/bootctl&quot; dev=&quot;dm-2&quot; ino=186106 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:bootloader_exec_t:s0 tclass=file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t bootloader_exec_t:file <span class="o">{</span> execute execute_no_trans map open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t bootloader_exec_t:file { execute execute_no_trans map open read };&quot;</span> -c my_dmesg_000009

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   37.880262] audit: type=1400 audit(1661367692.423:8): avc:  denied  { getattr } for  pid=3199 comm=&quot;systemd-tmpfile&quot; path=&quot;/var/cache/eix&quot; dev=&quot;dm-0&quot; ino=68937 scontext=system_u:system_r:systemd_tmpfiles_t:s0 tcontext=system_u:object_r:portage_cache_t:s0 tclass=dir permissive=0</span>
<span class="s">[   37.890742] audit: type=1400 audit(1661367692.426:10): avc:  denied  { read } for  pid=3199 comm=&quot;systemd-tmpfile&quot; name=&quot;eix&quot; dev=&quot;dm-0&quot; ino=68937 scontext=system_u:system_r:systemd_tmpfiles_t:s0 tcontext=system_u:object_r:portage_cache_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= systemd_tmpfiles_t ==============</span>

<span class="c1">#!!!! This avc can be allowed using the boolean &#39;systemd_tmpfiles_manage_all&#39;</span>
allow systemd_tmpfiles_t portage_cache_t:dir <span class="o">{</span> getattr <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ setsebool -P systemd_tmpfiles_manage_all on
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">[   37.623382] audit: type=1400 audit(1661368168.150:5): avc:  denied  { mounton } for  pid=3203 comm=&quot;(resolved)&quot; path=&quot;/run/systemd/unit-root/run/systemd/resolve&quot; dev=&quot;tmpfs&quot; ino=1551 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_resolved_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>

<span class="c1">#!!!! This avc can be allowed using the boolean &#39;init_mounton_non_security&#39;</span>
allow init_t systemd_resolved_runtime_t:dir mounton<span class="p">;</span>

❯ setsebool -P init_mounton_non_security on
</code></pre></div>
<h3 id="942-auditd-denials">9.4.2. auditd denials<a class="headerlink" href="#942-auditd-denials" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The following denials were retrieved with the help of <code>auditd.service</code>.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># ----</span>
<span class="c1"># time-&gt;Wed Aug 24 21:38:26 2022</span>
<span class="c1"># type=PROCTITLE msg=audit(1661369906.239:39): proctitle=6E6674002D66002D</span>
<span class="c1"># type=PATH msg=audit(1661369906.239:39): item=0 name=&quot;/var/lib/nftables/rules-save&quot; inode=221279 dev=00:21 mode=0100600 ouid=0 ogid=0 rdev=00:00 obj=system_u:object_r:var_lib_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="c1"># type=CWD msg=audit(1661369906.239:39): cwd=&quot;/&quot;</span>
<span class="c1"># type=SYSCALL msg=audit(1661369906.239:39): arch=c000003e syscall=262 success=no exit=-13 a0=ffffff9c a1=7ffee5ea26c0 a2=7ffee5ea2760 a3=100 items=1 ppid=3248 pid=3250 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=&quot;nft&quot; exe=&quot;/sbin/nft&quot; subj=system_u:system_r:iptables_t:s0 key=(null)</span>
<span class="c1"># type=AVC msg=audit(1661369906.239:39): avc:  denied  { getattr } for  pid=3250 comm=&quot;nft&quot; path=&quot;/var/lib/nftables/rules-save&quot; dev=&quot;dm-1&quot; ino=221279 scontext=system_u:system_r:iptables_t:s0 tcontext=system_u:object_r:var_lib_t:s0 tclass=file permissive=0</span>

❯ semanage fcontext -l <span class="p">|</span> grep -i <span class="s2">&quot;/var/lib&quot;</span> <span class="p">|</span> grep tables <span class="p">|</span> column -t
/var/lib/ip6?tables<span class="o">(</span>/.*<span class="o">)</span>?  all  files  system_u:object_r:initrc_tmp_t:s0

❯ sesearch -A -s iptables_t -t initrc_tmp_t -c file -p getattr
allow iptables_t initrc_tmp_t:file <span class="o">{</span> append getattr ioctl lock open <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>

❯ semanage fcontext -a -f a -s system_u -t initrc_tmp_t <span class="s1">&#39;/var/lib/nftables(/[^\.].*)?&#39;</span>

❯ restorecon -RFv /var/lib/nftables
Relabeled /var/lib/nftables from system_u:object_r:var_lib_t:s0 to system_u:object_r:initrc_tmp_t:s0
Relabeled /var/lib/nftables/rules-save from system_u:object_r:var_lib_t:s0 to system_u:object_r:initrc_tmp_t:s0
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Wed Aug 24 23:53:08 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661377988.663:43): proctitle=&quot;/lib/systemd/systemd-networkd&quot;</span>
<span class="s">type=PATH msg=audit(1661377988.663:43): item=0 name=&quot;/run/systemd/network&quot; inode=78 dev=00:1a mode=040755 ouid=0 ogid=0 rdev=00:00 obj=system_u:object_r:init_runtime_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661377988.663:43): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661377988.663:43): arch=c000003e syscall=257 success=no exit=-13 a0=ffffff9c a1=55df73b28c00 a2=90800 a3=0 items=1 ppid=1 pid=3261 auid=4294967295 uid=192 gid=192 euid=192 suid=192 fsuid=192 egid=192 sgid=192 fsgid=192 tty=(none) ses=4294967295 comm=&quot;systemd-network&quot; exe=&quot;/lib/systemd/systemd-networkd&quot; subj=system_u:system_r:systemd_networkd_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661377988.663:43): avc:  denied  { read } for  pid=3261 comm=&quot;systemd-network&quot; name=&quot;network&quot; dev=&quot;tmpfs&quot; ino=78 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:14:48 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661379288.763:43): proctitle=&quot;/lib/systemd/systemd-networkd&quot;</span>
<span class="s">type=PATH msg=audit(1661379288.763:43): item=0 name=&quot;/run/systemd/network/90-enp1s0.network&quot; inode=79 dev=00:1a mode=0100644 ouid=0 ogid=0 rdev=00:00 obj=system_u:object_r:init_runtime_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661379288.763:43): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661379288.763:43): arch=c000003e syscall=262 success=no exit=-13 a0=ffffff9c a1=55da01904c00 a2=7ffca10da400 a3=0 items=1 ppid=1 pid=3333 auid=4294967295 uid=192 gid=192 euid=192 suid=192 fsuid=192 egid=192 sgid=192 fsgid=192 tty=(none) ses=4294967295 comm=&quot;systemd-network&quot; exe=&quot;/lib/systemd/systemd-networkd&quot; subj=system_u:system_r:systemd_networkd_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661379288.763:43): avc:  denied  { getattr } for  pid=3333 comm=&quot;systemd-network&quot; path=&quot;/run/systemd/network/90-enp1s0.network&quot; dev=&quot;tmpfs&quot; ino=79 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:17:28 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661379448.229:51): proctitle=&quot;/lib/systemd/systemd-networkd&quot;</span>
<span class="s">type=PATH msg=audit(1661379448.229:51): item=0 name=&quot;/run/systemd/network/90-enp1s0.network&quot; inode=79 dev=00:1a mode=0100644 ouid=0 ogid=0 rdev=00:00 obj=system_u:object_r:init_runtime_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661379448.229:51): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661379448.229:51): arch=c000003e syscall=257 success=no exit=-13 a0=ffffff9c a1=5564bc5f9c00 a2=80000 a3=0 items=1 ppid=1 pid=3078 auid=4294967295 uid=192 gid=192 euid=192 suid=192 fsuid=192 egid=192 sgid=192 fsgid=192 tty=(none) ses=4294967295 comm=&quot;systemd-network&quot; exe=&quot;/lib/systemd/systemd-networkd&quot; subj=system_u:system_r:systemd_networkd_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661379448.229:51): avc:  denied  { read } for  pid=3078 comm=&quot;systemd-network&quot; name=&quot;90-enp1s0.network&quot; dev=&quot;tmpfs&quot; ino=79 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:20:51 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661379651.029:43): proctitle=&quot;/lib/systemd/systemd-networkd&quot;</span>
<span class="s">type=PATH msg=audit(1661379651.029:43): item=0 name=&quot;/run/systemd/network/90-enp1s0.network&quot; inode=80 dev=00:1a mode=0100644 ouid=0 ogid=0 rdev=00:00 obj=system_u:object_r:init_runtime_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661379651.029:43): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661379651.029:43): arch=c000003e syscall=257 success=no exit=-13 a0=ffffff9c a1=55732695ec00 a2=80000 a3=0 items=1 ppid=1 pid=3176 auid=4294967295 uid=192 gid=192 euid=192 suid=192 fsuid=192 egid=192 sgid=192 fsgid=192 tty=(none) ses=4294967295 comm=&quot;systemd-network&quot; exe=&quot;/lib/systemd/systemd-networkd&quot; subj=system_u:system_r:systemd_networkd_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661379651.029:43): avc:  denied  { open } for  pid=3176 comm=&quot;systemd-network&quot; path=&quot;/run/systemd/network/90-enp1s0.network&quot; dev=&quot;tmpfs&quot; ino=80 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:24:20 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661379860.443:43): proctitle=&quot;/lib/systemd/systemd-networkd&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661379860.443:43): arch=c000003e syscall=16 success=no exit=-13 a0=10 a1=5401 a2=7ffd638e1410 a3=1 items=0 ppid=1 pid=2975 auid=4294967295 uid=192 gid=192 euid=192 suid=192 fsuid=192 egid=192 sgid=192 fsgid=192 tty=(none) ses=4294967295 comm=&quot;systemd-network&quot; exe=&quot;/lib/systemd/systemd-networkd&quot; subj=system_u:system_r:systemd_networkd_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661379860.443:43): avc:  denied  { ioctl } for  pid=2975 comm=&quot;systemd-network&quot; path=&quot;/run/systemd/network/90-enp1s0.network&quot; dev=&quot;tmpfs&quot; ino=79 ioctlcmd=0x5401 scontext=system_u:system_r:systemd_networkd_t:s0 tcontext=system_u:object_r:init_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= systemd_networkd_t ==============</span>
allow systemd_networkd_t init_runtime_t:dir read<span class="p">;</span>
allow systemd_networkd_t init_runtime_t:file <span class="o">{</span> getattr ioctl open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow systemd_networkd_t init_runtime_t:dir read;&quot;</span> -c my_auditd_000000_dir
❯ selocal -a <span class="s2">&quot;allow systemd_networkd_t init_runtime_t:file { getattr ioctl open read };&quot;</span> -c my_auditd_000000_file

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:39:19 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661380759.276:59): proctitle=&quot;(agetty)&quot;</span>
<span class="s">type=PATH msg=audit(1661380759.276:59): item=0 name=&quot;/dev/tty1&quot; inode=20 dev=00:05 mode=020620 ouid=0 ogid=5 rdev=04:01 obj=system_u:object_r:tty_device_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661380759.276:59): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661380759.276:59): arch=c000003e syscall=254 success=no exit=-13 a0=3 a1=560c815bb0c0 a2=18 a3=5f932dd639e4204a items=1 ppid=1 pid=3416 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=&quot;(agetty)&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661380759.276:59): avc:  denied  { watch watch_reads } for  pid=3416 comm=&quot;(agetty)&quot; path=&quot;/dev/tty1&quot; dev=&quot;devtmpfs&quot; ino=20 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:tty_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 13:34:38 2022</span>
<span class="s">type=AVC msg=audit(1661427278.566:70): avc:  denied  { setattr } for  pid=1 comm=&quot;systemd&quot; name=&quot;ttyS0&quot; dev=&quot;devtmpfs&quot; ino=96 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:tty_device_t:s0 tclass=chr_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t tty_device_t:chr_file <span class="o">{</span> setattr watch watch_reads <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t tty_device_t:chr_file { setattr watch watch_reads };&quot;</span> -c my_auditd_000001

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:44:42 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661381082.870:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661381082.870:61): item=1 name=&quot;/run/user/1000/systemd&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661381082.870:61): item=0 name=&quot;/run/user/1000/&quot; inode=1 dev=00:38 mode=040700 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661381082.870:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661381082.870:61): arch=c000003e syscall=258 success=no exit=-13 a0=ffffff9c a1=55eb393f4ea0 a2=1ed a3=a5491cfe1f2629de items=2 ppid=1 pid=3288 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661381082.870:61): avc:  denied  { write } for  pid=3288 comm=&quot;systemd&quot; name=&quot;/&quot; dev=&quot;tmpfs&quot; ino=1 scontext=system_u:system_r:init_t:s0 tcontext=staff_u:object_r:user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:47:57 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661381277.279:69): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661381277.279:69): item=1 name=&quot;/run/user/1000/systemd&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661381277.279:69): item=0 name=&quot;/run/user/1000/&quot; inode=1 dev=00:37 mode=040700 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661381277.279:69): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661381277.279:69): arch=c000003e syscall=258 success=no exit=-13 a0=ffffff9c a1=55b3fd2dbea0 a2=1ed a3=dbecf310753cd1c items=2 ppid=1 pid=3324 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661381277.279:69): avc:  denied  { add_name } for  pid=3324 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=staff_u:object_r:user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t user_runtime_t:dir <span class="o">{</span> add_name write <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t user_runtime_t:dir { add_name write };&quot;</span> -c my_auditd_000002

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:59:07 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661381947.629:69): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661381947.629:69): item=1 name=&quot;/run/user/1000/systemd&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661381947.629:69): item=0 name=&quot;/run/user/1000/&quot; inode=1 dev=00:38 mode=040700 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661381947.629:69): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661381947.629:69): arch=c000003e syscall=258 success=no exit=-13 a0=ffffff9c a1=559df6213ea0 a2=1ed a3=60ed288b719f5baa items=2 ppid=1 pid=3432 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661381947.629:69): avc:  denied  { create } for  pid=3432 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=staff_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:08:31 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661382511.569:63): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661382511.569:63): item=1 name=&quot;/run/user/1000/systemd/inaccessible&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661382511.569:63): item=0 name=&quot;/run/user/1000/systemd/&quot; inode=2 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661382511.569:63): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661382511.569:63): arch=c000003e syscall=258 success=no exit=-13 a0=ffffff9c a1=55a9e2cdfb70 a2=1ed a3=1aeec676b3642e3d items=2 ppid=1 pid=3159 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661382511.569:63): avc:  denied  { write } for  pid=3159 comm=&quot;systemd&quot; name=&quot;systemd&quot; dev=&quot;tmpfs&quot; ino=2 scontext=system_u:system_r:init_t:s0 tcontext=staff_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:11:17 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661382677.403:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661382677.403:61): item=1 name=&quot;/run/user/1000/systemd/inaccessible&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661382677.403:61): item=0 name=&quot;/run/user/1000/systemd/&quot; inode=2 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661382677.403:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661382677.403:61): arch=c000003e syscall=258 success=no exit=-13 a0=ffffff9c a1=562000db7b70 a2=1ed a3=7e7ebf467e69ce4 items=2 ppid=1 pid=3363 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661382677.403:61): avc:  denied  { add_name } for  pid=3363 comm=&quot;systemd&quot; name=&quot;inaccessible&quot; scontext=system_u:system_r:init_t:s0 tcontext=staff_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:52:49 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661385169.613:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661385169.613:61): item=1 name=&quot;/run/user/1000/systemd/generator&quot; inode=10 dev=00:37 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:systemd_user_runtime_unit_t:s0 nametype=DELETE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661385169.613:61): item=0 name=&quot;/run/user/1000/systemd/&quot; inode=2 dev=00:37 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661385169.613:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661385169.613:61): arch=c000003e syscall=84 success=no exit=-13 a0=55dfb321d8a0 a1=cd7 a2=7fa895152d72 a3=4 items=2 ppid=1 pid=3281 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661385169.613:61): avc:  denied  { remove_name } for  pid=3281 comm=&quot;systemd&quot; name=&quot;generator&quot; dev=&quot;tmpfs&quot; ino=10 scontext=system_u:system_r:init_t:s0 tcontext=staff_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t systemd_user_runtime_t:dir <span class="o">{</span> add_name create remove_name write <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t systemd_user_runtime_t:dir { add_name create remove_name write };&quot;</span> -c my_auditd_000003

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 00:59:07 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661381947.629:69): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661381947.629:69): item=1 name=&quot;/run/user/1000/systemd&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661381947.629:69): item=0 name=&quot;/run/user/1000/&quot; inode=1 dev=00:38 mode=040700 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661381947.629:69): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661381947.629:69): arch=c000003e syscall=258 success=no exit=-13 a0=ffffff9c a1=559df6213ea0 a2=1ed a3=60ed288b719f5baa items=2 ppid=1 pid=3432 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661381947.629:69): avc:  denied  { create } for  pid=3432 comm=&quot;systemd&quot; name=&quot;systemd&quot; scontext=system_u:system_r:init_t:s0 tcontext=staff_u:object_r:systemd_user_runtime_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>

<span class="c1">#!!!! This avc is a constraint violation.  You would need to modify the attributes of either the source or target types to allow this access.</span>
<span class="c1">#Constraint rule:</span>
<span class="c1">#   constrain dir { create relabelfrom relabelto } ((u1 == u2 -Fail-)  or (t1 == can_change_object_identity -Fail-) ); Constraint DENIED</span>

<span class="c1">#   Possible cause is the source user (system_u) and target user (staff_u) are different.</span>
allow init_t systemd_user_runtime_t:dir create<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;domain_obj_id_change_exemption(init_t)&quot;</span> -c my_auditd_000004

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:14:01 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661382841.039:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661382841.039:61): item=1 name=&quot;/run/user/1000/systemd/inaccessible/reg&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661382841.039:61): item=0 name=&quot;/run/user/1000/systemd/inaccessible/&quot; inode=3 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661382841.039:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661382841.039:61): arch=c000003e syscall=259 success=no exit=-13 a0=ffffff9c a1=55933399bb70 a2=8000 a3=0 items=2 ppid=1 pid=3268 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661382841.039:61): avc:  denied  { create } for  pid=3268 comm=&quot;systemd&quot; name=&quot;reg&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_user_runtime_t:s0 tclass=file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:16:35 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661382995.279:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661382995.279:61): item=1 name=&quot;/run/user/1000/systemd/inaccessible/fifo&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661382995.279:61): item=0 name=&quot;/run/user/1000/systemd/inaccessible/&quot; inode=3 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661382995.279:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661382995.279:61): arch=c000003e syscall=259 success=no exit=-13 a0=ffffff9c a1=564c02a30b70 a2=1000 a3=0 items=2 ppid=1 pid=3262 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661382995.279:61): avc:  denied  { create } for  pid=3262 comm=&quot;systemd&quot; name=&quot;fifo&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_user_runtime_t:s0 tclass=fifo_file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:23:17 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661383397.123:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661383397.123:61): item=1 name=&quot;/run/user/1000/systemd/inaccessible/sock&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661383397.123:61): item=0 name=&quot;/run/user/1000/systemd/inaccessible/&quot; inode=3 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661383397.123:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661383397.123:61): arch=c000003e syscall=259 success=no exit=-13 a0=ffffff9c a1=55e4a6ed1b70 a2=c000 a3=0 items=2 ppid=1 pid=3278 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661383397.123:61): avc:  denied  { create } for  pid=3278 comm=&quot;systemd&quot; name=&quot;sock&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_user_runtime_t:s0 tclass=sock_file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:29:20 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661383760.239:62): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661383760.239:62): item=1 name=&quot;/run/user/1000/systemd/inaccessible/chr&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661383760.239:62): item=0 name=&quot;/run/user/1000/systemd/inaccessible/&quot; inode=3 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661383760.239:62): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661383760.239:62): arch=c000003e syscall=259 success=no exit=-13 a0=ffffff9c a1=5632bff78b70 a2=2000 a3=0 items=2 ppid=1 pid=3187 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661383760.239:62): avc:  denied  { create } for  pid=3187 comm=&quot;systemd&quot; name=&quot;chr&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_user_runtime_t:s0 tclass=chr_file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:56:22 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661385382.983:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661385382.983:61): item=0 name=&quot;/proc/self/fd/20&quot; inode=14 dev=00:37 mode=0140755 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661385382.983:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661385382.983:61): arch=c000003e syscall=280 success=no exit=-13 a0=ffffff9c a1=7fffd56539c0 a2=0 a3=0 items=1 ppid=1 pid=3378 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661385382.983:61): avc:  denied  { write } for  pid=3378 comm=&quot;systemd&quot; name=&quot;private&quot; dev=&quot;tmpfs&quot; ino=14 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_user_runtime_t:s0 tclass=sock_file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 02:04:33 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661385873.076:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661385873.076:61): item=2 name=&quot;/run/user/1000/systemd/units/.#invocation:dbus.socketccab4f1d32dec060&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661385873.076:61): item=1 name=&quot;3cc59378b35f4d579b487118b4e918ea&quot; nametype=UNKNOWN cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661385873.076:61): item=0 name=&quot;/run/user/1000/systemd/units/&quot; inode=9 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661385873.076:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661385873.076:61): arch=c000003e syscall=88 success=no exit=-13 a0=559116ee34b0 a1=559116f5da50 a2=55944ffae8ee a3=caab043e32a02748 items=3 ppid=1 pid=3266 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661385873.076:61): avc:  denied  { create } for  pid=3266 comm=&quot;systemd&quot; name=&quot;.#invocation:dbus.socketccab4f1d32dec060&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_user_runtime_t:s0 tclass=lnk_file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 10:03:06 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661414586.303:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661414586.303:61): item=3 name=&quot;/run/user/1000/systemd/units/invocation:dbus.socket&quot; nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661414586.303:61): item=2 name=&quot;/run/user/1000/systemd/units/.#invocation:dbus.socket6fa23590912098d5&quot; inode=16 dev=00:38 mode=0120777 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=DELETE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661414586.303:61): item=1 name=&quot;/run/user/1000/systemd/units/&quot; inode=9 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=PATH msg=audit(1661414586.303:61): item=0 name=&quot;/run/user/1000/systemd/units/&quot; inode=9 dev=00:38 mode=040755 ouid=1000 ogid=1000 rdev=00:00 obj=system_u:object_r:systemd_user_runtime_t:s0 nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661414586.303:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661414586.303:61): arch=c000003e syscall=82 success=no exit=-13 a0=55ad42211f70 a1=55ad421951e0 a2=55a818ce4340 a3=66f3775c14331539 items=4 ppid=1 pid=3770 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661414586.303:61): avc:  denied  { rename } for  pid=3770 comm=&quot;systemd&quot; name=&quot;.#invocation:dbus.socket6fa23590912098d5&quot; dev=&quot;tmpfs&quot; ino=16 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:systemd_user_runtime_t:s0 tclass=lnk_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t systemd_user_runtime_t:chr_file create<span class="p">;</span>
allow init_t systemd_user_runtime_t:fifo_file create<span class="p">;</span>
allow init_t systemd_user_runtime_t:file create<span class="p">;</span>
allow init_t systemd_user_runtime_t:lnk_file <span class="o">{</span> create rename <span class="o">}</span><span class="p">;</span>
allow init_t systemd_user_runtime_t:sock_file <span class="o">{</span> create write <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t systemd_user_runtime_t:chr_file create;&quot;</span> -c my_auditd_000005_chr_file
❯ selocal -a <span class="s2">&quot;allow init_t systemd_user_runtime_t:fifo_file create;&quot;</span> -c my_auditd_000005_fifo_file
❯ selocal -a <span class="s2">&quot;allow init_t systemd_user_runtime_t:file create;&quot;</span> -c my_auditd_000005_file
❯ selocal -a <span class="s2">&quot;allow init_t systemd_user_runtime_t:lnk_file { create rename };&quot;</span> -c my_auditd_000005_lnk_file
❯ selocal -a <span class="s2">&quot;allow init_t systemd_user_runtime_t:sock_file { create write };&quot;</span> -c my_auditd_000005_sock_file

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:35:11 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661384111.956:61): proctitle=&quot;/usr/lib/systemd/user-environment-generators/30-systemd-environment-d-generator&quot;</span>
<span class="s">type=PATH msg=audit(1661384111.956:61): item=0 name=&quot;&quot; inode=265 dev=00:21 mode=040700 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:xdg_config_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661384111.956:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661384111.956:61): arch=c000003e syscall=262 success=no exit=-13 a0=4 a1=7ff72be7df13 a2=7ffff656b200 a3=1000 items=1 ppid=3264 pid=3265 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;30-systemd-envi&quot; exe=&quot;/usr/lib/systemd/user-environment-generators/30-systemd-environment-d-generator&quot; subj=system_u:system_r:systemd_generator_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661384111.956:61): avc:  denied  { getattr } for  pid=3265 comm=&quot;30-systemd-envi&quot; path=&quot;/home/david/.config&quot; dev=&quot;dm-0&quot; ino=265 scontext=system_u:system_r:systemd_generator_t:s0 tcontext=staff_u:object_r:xdg_config_t:s0 tclass=dir permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 01:38:28 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661384308.306:61): proctitle=&quot;/usr/lib/systemd/user-environment-generators/30-systemd-environment-d-generator&quot;</span>
<span class="s">type=PATH msg=audit(1661384308.306:61): item=0 name=&quot;environment.d&quot; nametype=UNKNOWN cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661384308.306:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661384308.306:61): arch=c000003e syscall=257 success=no exit=-13 a0=4 a1=561d1e9652d0 a2=2a0000 a3=0 items=1 ppid=3273 pid=3274 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;30-systemd-envi&quot; exe=&quot;/usr/lib/systemd/user-environment-generators/30-systemd-environment-d-generator&quot; subj=system_u:system_r:systemd_generator_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661384308.306:61): avc:  denied  { search } for  pid=3274 comm=&quot;30-systemd-envi&quot; name=&quot;.config&quot; dev=&quot;dm-1&quot; ino=265 scontext=system_u:system_r:systemd_generator_t:s0 tcontext=staff_u:object_r:xdg_config_t:s0 tclass=dir permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= systemd_generator_t ==============</span>
allow systemd_generator_t xdg_config_t:dir <span class="o">{</span> getattr search <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow systemd_generator_t xdg_config_t:dir { getattr search };&quot;</span> -c my_auditd_000006

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 02:00:35 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661385635.276:61): proctitle=2F6C69622F73797374656D642F73797374656D64002D2D75736572</span>
<span class="s">type=PATH msg=audit(1661385635.276:61): item=0 name=&quot;/proc/self/fd/26&quot; inode=15 dev=00:38 mode=0140666 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:object_r:session_dbusd_runtime_t:s0 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661385635.276:61): cwd=&quot;/&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661385635.276:61): arch=c000003e syscall=280 success=no exit=-13 a0=ffffff9c a1=7ffc4a0a5f70 a2=0 a3=0 items=1 ppid=1 pid=3268 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=(none) ses=2 comm=&quot;systemd&quot; exe=&quot;/lib/systemd/systemd&quot; subj=system_u:system_r:init_t:s0 key=(null)</span>
<span class="s">type=AVC msg=audit(1661385635.276:61): avc:  denied  { write } for  pid=3268 comm=&quot;systemd&quot; name=&quot;bus&quot; dev=&quot;tmpfs&quot; ino=15 scontext=system_u:system_r:init_t:s0 tcontext=staff_u:object_r:session_dbusd_runtime_t:s0 tclass=sock_file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= init_t ==============</span>
allow init_t session_dbusd_runtime_t:sock_file write<span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow init_t session_dbusd_runtime_t:sock_file write;&quot;</span> -c my_auditd_000007

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 11:18:48 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661419128.603:65): proctitle=7375646F002D69</span>
<span class="s">type=PATH msg=audit(1661419128.603:65): item=0 name=&quot;/proc/3268/stat&quot; nametype=UNKNOWN cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661419128.603:65): cwd=&quot;/home/david&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661419128.603:65): arch=c000003e syscall=257 success=no exit=-13 a0=ffffff9c a1=7ffebc1a77b0 a2=20000 a3=0 items=1 ppid=3268 pid=3296 auid=1000 uid=1000 gid=1000 euid=0 suid=0 fsuid=0 egid=1000 sgid=1000 fsgid=1000 tty=pts0 ses=1 comm=&quot;sudo&quot; exe=&quot;/usr/bin/sudo&quot; subj=staff_u:staff_r:staff_sudo_t:s0-s0:c0.c1023 key=(null)</span>
<span class="s">type=AVC msg=audit(1661419128.603:65): avc:  denied  { search } for  pid=3296 comm=&quot;sudo&quot; name=&quot;3268&quot; dev=&quot;proc&quot; ino=23326 scontext=staff_u:staff_r:staff_sudo_t:s0-s0:c0.c1023 tcontext=staff_u:staff_r:staff_t:s0-s0:c0.c1023 tclass=dir permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 11:21:23 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661419283.933:65): proctitle=7375646F002D69</span>
<span class="s">type=PATH msg=audit(1661419283.933:65): item=0 name=&quot;/proc/3172/stat&quot; inode=21310 dev=00:16 mode=0100444 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:staff_r:staff_t:s0-s0:c0.c1023 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661419283.933:65): cwd=&quot;/home/david&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661419283.933:65): arch=c000003e syscall=257 success=no exit=-13 a0=ffffff9c a1=7ffc8f06ad90 a2=20000 a3=0 items=1 ppid=3172 pid=3197 auid=1000 uid=1000 gid=1000 euid=0 suid=0 fsuid=0 egid=1000 sgid=1000 fsgid=1000 tty=pts0 ses=1 comm=&quot;sudo&quot; exe=&quot;/usr/bin/sudo&quot; subj=staff_u:staff_r:staff_sudo_t:s0-s0:c0.c1023 key=(null)</span>
<span class="s">type=AVC msg=audit(1661419283.933:65): avc:  denied  { read } for  pid=3197 comm=&quot;sudo&quot; name=&quot;stat&quot; dev=&quot;proc&quot; ino=21310 scontext=staff_u:staff_r:staff_sudo_t:s0-s0:c0.c1023 tcontext=staff_u:staff_r:staff_t:s0-s0:c0.c1023 tclass=file permissive=0</span>
<span class="s">----</span>
<span class="s">time-&gt;Thu Aug 25 11:24:21 2022</span>
<span class="s">type=PROCTITLE msg=audit(1661419461.606:65): proctitle=7375646F002D69</span>
<span class="s">type=PATH msg=audit(1661419461.606:65): item=0 name=&quot;/proc/3077/stat&quot; inode=22073 dev=00:16 mode=0100444 ouid=1000 ogid=1000 rdev=00:00 obj=staff_u:staff_r:staff_t:s0-s0:c0.c1023 nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span>
<span class="s">type=CWD msg=audit(1661419461.606:65): cwd=&quot;/home/david&quot;</span>
<span class="s">type=SYSCALL msg=audit(1661419461.606:65): arch=c000003e syscall=257 success=no exit=-13 a0=ffffff9c a1=7ffde6d86d20 a2=20000 a3=0 items=1 ppid=3077 pid=3102 auid=1000 uid=1000 gid=1000 euid=0 suid=0 fsuid=0 egid=1000 sgid=1000 fsgid=1000 tty=pts0 ses=1 comm=&quot;sudo&quot; exe=&quot;/usr/bin/sudo&quot; subj=staff_u:staff_r:staff_sudo_t:s0-s0:c0.c1023 key=(null)</span>
<span class="s">type=AVC msg=audit(1661419461.606:65): avc:  denied  { open } for  pid=3102 comm=&quot;sudo&quot; path=&quot;/proc/3077/stat&quot; dev=&quot;proc&quot; ino=22073 scontext=staff_u:staff_r:staff_sudo_t:s0-s0:c0.c1023 tcontext=staff_u:staff_r:staff_t:s0-s0:c0.c1023 tclass=file permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= staff_sudo_t ==============</span>
allow staff_sudo_t staff_t:dir search<span class="p">;</span>
allow staff_sudo_t staff_t:file <span class="o">{</span> open <span class="nb">read</span> <span class="o">}</span><span class="p">;</span>

❯ selocal -a <span class="s2">&quot;allow staff_sudo_t staff_t:dir search;&quot;</span> -c my_auditd_000008_dir
❯ selocal -a <span class="s2">&quot;allow staff_sudo_t staff_t:file { open read };&quot;</span> -c my_auditd_000008_file

❯ selocal -b -L
</code></pre></div>
<div class="highlight"><pre><span></span><code>❯ semodule -DB

❯ cat <span class="s">&lt;&lt;EOF | audit2allow</span>
<span class="s">----</span>
<span class="s">type=AVC msg=audit(1661427872.643:74): avc:  denied  { use } for  pid=3163 comm=&quot;login&quot; path=&quot;/dev/ttyS0&quot; dev=&quot;devtmpfs&quot; ino=96 scontext=system_u:system_r:local_login_t:s0 tcontext=system_u:system_r:init_t:s0 tclass=fd permissive=0</span>
<span class="s">EOF</span>


<span class="c1">#============= local_login_t ==============</span>
allow local_login_t init_t:fd use<span class="p">;</span>

❯ semodule -B

❯ selocal -a <span class="s2">&quot;allow local_login_t init_t:fd use;&quot;</span> -c my_dont_audit_000000

❯ selocal -b -L
</code></pre></div>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../post-boot_configuration/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 8. Post-Boot Configuration" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              8. Post-Boot Configuration
            </div>
          </div>
        </a>
      
      
        
        <a href="../other_gentoo_linux_repos/" class="md-footer__link md-footer__link--next" aria-label="Next: 10. Other Gentoo Linux repos" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              10. Other Gentoo Linux repos
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>