<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Gentoo installation using Measured Boot, Secure Boot, Full Disk Encryption, RAID and offering a rescue system based on customised SystemRescueCD"><meta name=author content="David Sardari"><link href=https://gentoo.duxsco.de/portage_setup/ rel=canonical><link href=../chrooting/ rel=prev><link href=../non-root_user/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.13"><title>6. Portage Setup - Gentoo Linux with Measured Boot</title><link rel=stylesheet href=../assets/stylesheets/main.ffa9267a.min.css><link rel=stylesheet href=../assets/stylesheets/palette.a0c5b2b5.min.css><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#61-portage-configuration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Gentoo Linux with Measured Boot" class="md-header__button md-logo" aria-label="Gentoo Linux with Measured Boot" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Gentoo Linux with Measured Boot </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 6. Portage Setup </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/duxsco/gentoo-installation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg> </div> <div class=md-source__repository> duxsco/gentoo-installation </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Gentoo Linux with Measured Boot" class="md-nav__button md-logo" aria-label="Gentoo Linux with Measured Boot" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Gentoo Linux with Measured Boot </label> <div class=md-nav__source> <a href=https://github.com/duxsco/gentoo-installation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg> </div> <div class=md-source__repository> duxsco/gentoo-installation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> 1. Introduction </a> </li> <li class=md-nav__item> <a href=../live-cd_environment/ class=md-nav__link> 2. Live-CD Environment </a> </li> <li class=md-nav__item> <a href=../disk_setup/ class=md-nav__link> 3. Disk Setup </a> </li> <li class=md-nav__item> <a href=../rescue_system/ class=md-nav__link> 4. Rescue System </a> </li> <li class=md-nav__item> <a href=../chrooting/ class=md-nav__link> 5. Chrooting </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 6. Portage Setup <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 6. Portage Setup </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#61-portage-configuration class=md-nav__link> 6.1. Portage Configuration </a> </li> <li class=md-nav__item> <a href=#62-optional-custom-mirrors class=md-nav__link> 6.2. (Optional) Custom Mirrors </a> </li> <li class=md-nav__item> <a href=#63-repo-syncing class=md-nav__link> 6.3. Repo Syncing </a> </li> <li class=md-nav__item> <a href=#64-optional-hardened-profiles class=md-nav__link> 6.4. (Optional) Hardened Profiles </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../non-root_user/ class=md-nav__link> 7. Non-Root User </a> </li> <li class=md-nav__item> <a href=../bootup_setup/ class=md-nav__link> 8. Bootup Setup </a> </li> <li class=md-nav__item> <a href=../unified_kernel_image/ class=md-nav__link> 9. Unified Kernel Image </a> </li> <li class=md-nav__item> <a href=../ssh_server/ class=md-nav__link> 10. SSH Server (optional) </a> </li> <li class=md-nav__item> <a href=../cleanup_and_reboot/ class=md-nav__link> 11. Cleanup And Reboot </a> </li> <li class=md-nav__item> <a href=../post-boot_configuration/ class=md-nav__link> 12. Post-Boot Configuration </a> </li> <li class=md-nav__item> <a href=../virtual_server/ class=md-nav__link> 13. Virtual Server (optional) </a> </li> <li class=md-nav__item> <a href=../selinux/ class=md-nav__link> 14. SELinux (optional) </a> </li> <li class=md-nav__item> <a href=../desktop_profiles/ class=md-nav__link> 15. Desktop Profiles (optional) </a> </li> <li class=md-nav__item> <a href=../other_gentoo_linux_repos/ class=md-nav__link> 16. Other Gentoo Linux Repos </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#61-portage-configuration class=md-nav__link> 6.1. Portage Configuration </a> </li> <li class=md-nav__item> <a href=#62-optional-custom-mirrors class=md-nav__link> 6.2. (Optional) Custom Mirrors </a> </li> <li class=md-nav__item> <a href=#63-repo-syncing class=md-nav__link> 6.3. Repo Syncing </a> </li> <li class=md-nav__item> <a href=#64-optional-hardened-profiles class=md-nav__link> 6.4. (Optional) Hardened Profiles </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>6. Portage Setup</h1> <div class="admonition info"> <p class=admonition-title>Application of configuration changes</p> <p>Starting with this chapter, <strong>execute <a href=https://wiki.gentoo.org/wiki/Dispatch-conf>dispatch-conf</a> after every codeblock</strong> where a <a href=https://projects.gentoo.org/pms/8/pms.html#x1-14600013.3.3>"._cfg0000_" prefixed file</a> has been created. <mark class=critic>The creation of "._cfg0000_" prefixed files will be highlighted in yellow.</mark> Alternatively, <a href=https://wiki.gentoo.org/wiki/Handbook:X86/Portage/Tools#etc-update>etc-update</a> or <a href=https://wiki.gentoo.org/wiki/Cfg-update>cfg-update</a> might be s.th. to consider, but I haven't tested those.</p> </div> <p>Make "dispatch-conf" show <a href=https://wiki.gentoo.org/wiki/Dispatch-conf#Changing_diff_or_merge_tools>diffs in color</a> and use <a href=https://wiki.gentoo.org/wiki/Dispatch-conf#Use_.28g.29vimdiff_to_merge_changes>vimdiff for merging</a>:</p> <div class=highlight><pre><span></span><code><span class=hll>rsync<span class=w> </span>-a<span class=w> </span>/etc/dispatch-conf.conf<span class=w> </span>/etc/._cfg0000_dispatch-conf.conf<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
</span>sed<span class=w> </span>-i<span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=s2>&quot;s/diff=\&quot;diff -Nu &#39;%s&#39; &#39;%s&#39;\&quot;/diff=\&quot;diff --color=always -Nu &#39;%s&#39; &#39;%s&#39;\&quot;/&quot;</span><span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=s2>&quot;s/merge=\&quot;sdiff --suppress-common-lines --output=&#39;%s&#39; &#39;%s&#39; &#39;%s&#39;\&quot;/merge=\&quot;vimdiff -c&#39;saveas %s&#39; -c next -c&#39;setlocal noma readonly&#39; -c prev %s %s\&quot;/&quot;</span><span class=w> </span><span class=se>\</span>
/etc/._cfg0000_dispatch-conf.conf<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\e[1;32mSUCCESS\e[0m&quot;</span>
</code></pre></div> <h2 id=61-portage-configuration>6.1. Portage Configuration<a class=headerlink href=#61-portage-configuration title="Permanent link">&para;</a></h2> <p>Configure <a href=https://wiki.gentoo.org/wiki//etc/portage/make.conf>make.conf</a> (copy&amp;paste one after the other):</p> <div class="no-copy highlight"><pre><span></span><code><span class=hll>rsync<span class=w> </span>-av<span class=w> </span>/etc/portage/make.conf<span class=w> </span>/etc/portage/._cfg0000_make.conf
</span>
<span class=c1># If you use distcc, beware of:</span>
<span class=c1># https://wiki.gentoo.org/wiki/Distcc#-march.3Dnative</span>
<span class=c1>#</span>
<span class=c1># You could resolve &quot;-march=native&quot; with app-misc/resolve-march-native</span>
sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/COMMON_FLAGS=&quot;-O2 -pipe&quot;/COMMON_FLAGS=&quot;-march=native -O2 -pipe&quot;/&#39;</span><span class=w> </span>/etc/portage/._cfg0000_make.conf

<span class=c1># https://wiki.gentoo.org/wiki/EMERGE_DEFAULT_OPTS</span>
<span class=c1># https://wiki.gentoo.org/wiki/Binary_package_guide#Excluding_creation_of_some_packages</span>
<span class=c1>#</span>
<span class=c1># For all other flags, take a look at &quot;man emerge&quot; or</span>
<span class=c1># https://gitweb.gentoo.org/proj/portage.git/tree/man/emerge.1</span>
<span class=nb>echo</span><span class=w> </span><span class=s1>&#39;EMERGE_DEFAULT_OPTS=&quot;--buildpkg --buildpkg-exclude &#39;</span><span class=se>\&#39;</span><span class=s1>&#39;*/*-bin sys-kernel/* virtual/*&#39;</span><span class=se>\&#39;</span><span class=s1>&#39; --noconfmem --with-bdeps=y --complete-graph=y&quot;&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/portage/._cfg0000_make.conf

<span class=c1># https://wiki.gentoo.org/wiki/Localization/Guide#L10N</span>
<span class=c1># https://wiki.gentoo.org/wiki/Localization/Guide#LINGUAS</span>
<span class=nb>echo</span><span class=w> </span><span class=s1>&#39;</span>
<span class=s1>L10N=&quot;de&quot;</span>
<span class=s1>LINGUAS=&quot;${L10N}&quot;&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/portage/._cfg0000_make.conf

<span class=c1># https://wiki.gentoo.org/wiki/GENTOO_MIRRORS</span>
<span class=c1># https://www.gentoo.org/downloads/mirrors/</span>
<span class=nb>echo</span><span class=w> </span><span class=s1>&#39;</span>
<span class=s1>GENTOO_MIRRORS=&quot;https://ftp-stud.hs-esslingen.de/pub/Mirrors/gentoo/ https://ftp.fau.de/gentoo/ https://ftp.tu-ilmenau.de/mirror/gentoo/&quot;&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/portage/._cfg0000_make.conf

<span class=c1># https://wiki.gentoo.org/wiki/Handbook:AMD64/Full/Portage#Fetch_commands</span>
<span class=c1>#</span>
<span class=c1># Default values from /usr/share/portage/config/make.globals are:</span>
<span class=c1># FETCHCOMMAND=&quot;wget -t 3 -T 60 --passive-ftp -O \&quot;\${DISTDIR}/\${FILE}\&quot; \&quot;\${URI}\&quot;&quot;</span>
<span class=c1># RESUMECOMMAND=&quot;wget -c -t 3 -T 60 --passive-ftp -O \&quot;\${DISTDIR}/\${FILE}\&quot; \&quot;\${URI}\&quot;&quot;</span>
<span class=c1>#</span>
<span class=c1># File in git: https://gitweb.gentoo.org/proj/portage.git/tree/cnf/make.globals</span>
<span class=c1>#</span>
<span class=c1># They are insufficient in my opinion.</span>
<span class=c1># Thus, I am enforcing TLSv1.2 or greater, secure TLSv1.2 cipher suites and https-only.</span>
<span class=c1># TLSv1.3 cipher suites are secure. Thus, I don&#39;t set &quot;--tls13-ciphers&quot;.</span>
<span class=nb>echo</span><span class=w> </span><span class=s1>&#39;FETCHCOMMAND=&quot;curl --fail --silent --show-error --location --proto &#39;</span><span class=se>\&#39;</span><span class=s1>&#39;=https&#39;</span><span class=se>\&#39;</span><span class=s1>&#39; --tlsv1.2 --ciphers &#39;</span><span class=se>\&#39;</span><span class=s1>&#39;ECDHE+AESGCM+AES256:ECDHE+CHACHA20:ECDHE+AESGCM+AES128&#39;</span><span class=se>\&#39;</span><span class=s1>&#39; --retry 2 --connect-timeout 60 -o \&quot;\${DISTDIR}/\${FILE}\&quot; \&quot;\${URI}\&quot;&quot;</span>
<span class=s1>RESUMECOMMAND=&quot;${FETCHCOMMAND} --continue-at -&quot;&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/portage/._cfg0000_make.conf

<span class=c1># Some useflags I set for personal use.</span>
<span class=c1># Feel free to adjust as with any other codeblock. 😄</span>
<span class=nb>echo</span><span class=w> </span><span class=s1>&#39;</span>
<span class=s1>USE_HARDENED=&quot;caps pie -sslv3 -suid&quot;</span>
<span class=s1>USE=&quot;${USE_HARDENED}&quot;&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/portage/._cfg0000_make.conf
</code></pre></div> <p>I prefer English manpages and ignore above <a href=https://wiki.gentoo.org/wiki/Localization/Guide#L10N>L10N</a> setting for "sys-apps/man-pages". Makes using Stackoverflow easier <img alt=😉 class=twemoji src=https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f609.svg title=:wink:>.</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;sys-apps/man-pages -l10n_de&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/portage/package.use/main<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\e[1;32mSUCCESS\e[0m&quot;</span>
</code></pre></div> <p>Set <a href=https://wiki.gentoo.org/wiki/CPU_FLAGS_X86#Using_cpuid2cpuflags>CPU flags</a>:</p> <div class=highlight><pre><span></span><code>emerge<span class=w> </span>--oneshot<span class=w> </span>app-portage/cpuid2cpuflags<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<span class=nb>echo</span><span class=w> </span><span class=s2>&quot;*/* </span><span class=k>$(</span>cpuid2cpuflags<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span>&gt;<span class=w> </span>/etc/portage/package.use/00cpu-flags<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\e[1;32mSUCCESS\e[0m&quot;</span>
</code></pre></div> <h2 id=62-optional-custom-mirrors>6.2. (Optional) Custom Mirrors<a class=headerlink href=#62-optional-custom-mirrors title="Permanent link">&para;</a></h2> <p>If you don't live in Germany, you probably should change <a href=https://wiki.gentoo.org/wiki/GENTOO_MIRRORS>GENTOO_MIRRORS</a> previously set in <a href=#61-portage-configuration>6.1. Portage Configuration</a>. You can pick the mirrors from the <a href=https://www.gentoo.org/downloads/mirrors/ >mirror list</a>, use <a href=https://wiki.gentoo.org/wiki/Mirrorselect>mirrorselect</a> or do as I do and select local/regional, IPv4/IPv6 dual-stack and TLSv1.3 supporting mirrors (copy&amp;paste one after the other):</p> <div class="no-copy highlight"><pre><span></span><code><span class=c1># Install app-misc/yq</span>
<span class=nv>ACCEPT_KEYWORDS</span><span class=o>=</span><span class=s2>&quot;~amd64&quot;</span><span class=w> </span>emerge<span class=w> </span>--oneshot<span class=w> </span>app-misc/yq

<span class=c1># Get a list of country codes and names:</span>
curl<span class=w> </span>-fsSL<span class=w> </span>--proto<span class=w> </span><span class=s1>&#39;=https&#39;</span><span class=w> </span>--tlsv1.3<span class=w> </span>https://api.gentoo.org/mirrors/distfiles.xml<span class=w> </span><span class=p>|</span><span class=w> </span>xq<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;.mirrors.mirrorgroup[] | &quot;\(.[&quot;@country&quot;]) \(.[&quot;@countryname&quot;])&quot;&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-k2.2

<span class=c1># Choose your countries the mirrors should be located in:</span>
<span class=nv>country</span><span class=o>=</span><span class=s1>&#39;&quot;AU&quot;,&quot;BE&quot;,&quot;BR&quot;,&quot;CA&quot;,&quot;CH&quot;,&quot;CL&quot;,&quot;CN&quot;,&quot;CZ&quot;,&quot;DE&quot;,&quot;DK&quot;,&quot;ES&quot;,&quot;FR&quot;,&quot;GR&quot;,&quot;HK&quot;,&quot;IL&quot;,&quot;IT&quot;,&quot;JP&quot;,&quot;KR&quot;,&quot;KZ&quot;,&quot;LU&quot;,&quot;NA&quot;,&quot;NC&quot;,&quot;NL&quot;,&quot;PH&quot;,&quot;PL&quot;,&quot;PT&quot;,&quot;RO&quot;,&quot;RU&quot;,&quot;SG&quot;,&quot;SK&quot;,&quot;TR&quot;,&quot;TW&quot;,&quot;UK&quot;,&quot;US&quot;,&quot;ZA&quot;&#39;</span>

<span class=c1># Get a list of mirrors available over IPv4/IPv6 dual-stack in the countries of your choice with TLSv1.3 support</span>
<span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>i<span class=p>;</span><span class=w> </span><span class=k>do</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span>curl<span class=w> </span>-fsL<span class=w> </span>--proto<span class=w> </span><span class=s1>&#39;=https&#39;</span><span class=w> </span>--tlsv1.3<span class=w> </span>-I<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>&gt;/dev/null<span class=p>;</span><span class=w> </span><span class=k>then</span>
<span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=w>  </span><span class=k>fi</span>
<span class=k>done</span><span class=w> </span>&lt;<span class=w> </span>&lt;<span class=o>(</span>
<span class=w>  </span>curl<span class=w> </span>-fsSL<span class=w> </span>--proto<span class=w> </span><span class=s1>&#39;=https&#39;</span><span class=w> </span>--tlsv1.3<span class=w> </span>https://api.gentoo.org/mirrors/distfiles.xml<span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>xq<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;.mirrors.mirrorgroup[] | select([.\&quot;@country\&quot;] | inside([</span><span class=si>${</span><span class=nv>country</span><span class=si>}</span><span class=s2>])) | .mirror | if type==\&quot;array\&quot; then .[] else . end | .uri | if type==\&quot;array\&quot; then .[] else . end | select(.\&quot;@protocol\&quot; == \&quot;http\&quot; and .\&quot;@ipv4\&quot; == \&quot;y\&quot; and .\&quot;@ipv6\&quot; == \&quot;y\&quot; and (.\&quot;#text\&quot; | startswith(\&quot;https://\&quot;))) | .\&quot;#text\&quot;&quot;</span>
<span class=o>)</span>
</code></pre></div> <h2 id=63-repo-syncing>6.3. Repo Syncing<a class=headerlink href=#63-repo-syncing title="Permanent link">&para;</a></h2> <p>Mitigate <a href="https://bugs.gentoo.org/show_bug.cgi?id=CVE-2022-29154">CVE-2022-29154</a> among others before using "rsync" via "eix-sync":</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;net-misc/rsync ~amd64&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/etc/portage/package.accept_keywords/main<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
emerge<span class=w> </span>--oneshot<span class=w> </span>net-misc/rsync<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\e[1;32mSUCCESS\e[0m&quot;</span>
</code></pre></div> <p>I personally prefer syncing the repo via <a href=https://wiki.gentoo.org/wiki/Eix#Method_2:_Using_eix-sync>"eix-sync"</a> which is provided by <a href=https://wiki.gentoo.org/wiki/Eix>app-portage/eix</a>. But, there are <a href=https://wiki.gentoo.org/wiki/Gentoo_Cheat_Sheet#Sync_methods>some of other options</a>:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:3><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>eix-sync</label><label for=__tabbed_1_2>emaint (replaced "emerge --sync")</label><label for=__tabbed_1_3>emerge-webrsync</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>emerge<span class=w> </span>app-portage/eix<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
eix-sync
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>emaint<span class=w> </span>--auto<span class=w> </span>sync
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>emerge-webrsync
</code></pre></div> </div> </div> </div> <p>Read <a href=https://www.gentoo.org/glep/glep-0042.html>Gentoo news items</a>:</p> <div class=highlight><pre><span></span><code>eselect<span class=w> </span>news<span class=w> </span>list
<span class=c1># eselect news read 1</span>
<span class=c1># eselect news read 2</span>
<span class=c1># etc.</span>
</code></pre></div> <h2 id=64-optional-hardened-profiles>6.4. (Optional) Hardened Profiles<a class=headerlink href=#64-optional-hardened-profiles title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Desktop Profiles</p> <p>To make things simple, hardened desktop profiles are only considered for selection at the end of this guide in chapter <a href=/desktop_profiles/ >15. Desktop profiles (optional)</a>.</p> </div> <p>Switch over to the custom <a href=https://wiki.gentoo.org/wiki/Project:Hardened>hardened</a> profile. Additional ressources:</p> <ul> <li><a href=https://github.com/duxsco/gentoo-installation/tree/main/overlay/duxsco/profiles>My custom profiles</a></li> <li><a href=https://wiki.gentoo.org/wiki/Profile_(Portage)#Creating_custom_profiles>Creating custom profiles</a></li> <li><a href=https://wiki.gentoo.org/wiki/Hardened_Gentoo#Switching_to_a_Hardened_profile>Switching to a hardened profile</a></li> </ul> <div class=highlight><pre><span></span><code>eselect<span class=w> </span>profile<span class=w> </span><span class=nb>set</span><span class=w> </span>duxsco:hardened-systemd-merged-usr<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
env-update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>source</span><span class=w> </span>/etc/profile<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>PS1</span><span class=o>=</span><span class=s2>&quot;(chroot) </span><span class=nv>$PS1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
emerge<span class=w> </span>--oneshot<span class=w> </span>sys-devel/gcc<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
emerge<span class=w> </span>--oneshot<span class=w> </span>sys-devel/binutils<span class=w> </span>sys-libs/glibc<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
env-update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>source</span><span class=w> </span>/etc/profile<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>PS1</span><span class=o>=</span><span class=s2>&quot;(chroot) </span><span class=nv>$PS1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
emerge<span class=w> </span>-e<span class=w> </span>@world<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
env-update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>source</span><span class=w> </span>/etc/profile<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>export</span><span class=w> </span><span class=nv>PS1</span><span class=o>=</span><span class=s2>&quot;(chroot) </span><span class=nv>$PS1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\e[1;32mSUCCESS\e[0m&quot;</span>
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../chrooting/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 5. Chrooting" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 5. Chrooting </div> </div> </a> <a href=../non-root_user/ class="md-footer__link md-footer__link--next" aria-label="Next: 7. Non-Root User" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> 7. Non-Root User </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "content.code.copy", "navigation.footer", "navigation.instant"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.2a6f1dda.min.js></script> </body> </html>